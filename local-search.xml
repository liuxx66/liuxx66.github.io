<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ElasticSearch安装和基本使用</title>
    <link href="/2024/05/11/ElasticSearch/"/>
    <url>/2024/05/11/ElasticSearch/</url>
    
    <content type="html"><![CDATA[<h2 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h2><hr><ul><li>作用：日志存储和检索。</li></ul><blockquote><p>filebeat：用于日志收集</p><p>logstash：日志 转换，可也可以日志采集</p><p>kibana：用于日志展示</p><p>kafka：消息队列</p></blockquote><ul><li>准备机器</li></ul><blockquote><p>192.168.10.101: 2C4G-50G，node1-10-101，root&#x2F;123456</p><p>192.168.10.102: 2C4G-50G，node2-10-102，root&#x2F;123456</p><p>192.168.10.103: 2C4G-50G，node3-10-103，root&#x2F;123456</p></blockquote><hr><h3 id="1、单机版本安装-7-17-15"><a href="#1、单机版本安装-7-17-15" class="headerlink" title="1、单机版本安装 7.17.15"></a>1、单机版本安装 7.17.15</h3><ul><li>官网下载地址</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">https://www.elastic.co/cn/downloads<br></code></pre></td></tr></table></figure><blockquote><p>找到以前版本</p><img src="ElasticSearch.assets/image-20240402211217013.png" alt="image-20240402211217013" style="zoom: 67%;" /><img src="ElasticSearch.assets/image-20240402211249241.png" alt="image-20240402211249241" style="zoom:67%;" /></blockquote><h4 id="1-1、上传RPM包并安装"><a href="#1-1、上传RPM包并安装" class="headerlink" title="1.1、上传RPM包并安装"></a>1.1、上传RPM包并安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p /opt/elasticSearch<br>cd /opt/elasticSearch/<br><br>yum -y install elasticsearch-7.17.15-x86_64.rpm<br></code></pre></td></tr></table></figure><h6 id="1-1-1、设置查看带-开头配置文件命令别名"><a href="#1-1-1、设置查看带-开头配置文件命令别名" class="headerlink" title="1.1.1、设置查看带#开头配置文件命令别名"></a>1.1.1、设置查看带#开头配置文件命令别名</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@node1-10-101 elasticSearch]# egrep -v &quot;^#|^$&quot; /etc/elasticsearch/elasticsearch.yml<br>path.data: /var/lib/elasticsearch<br>path.logs: /var/log/elasticsearch<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">添加命令别名</span><br>vim /root/.bashrc<br>alias yy=&#x27;egrep -v &quot;^#|^$&quot;&#x27;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">使 .bashrc 配置生效</span><br>source /root/.bashrc<br><br>[root@node1-10-101 elasticSearch]# yy /etc/elasticsearch/elasticsearch.yml<br>path.data: /var/lib/elasticsearch<br>path.logs: /var/log/elasticsearch<br><br></code></pre></td></tr></table></figure><h4 id="1-2、修改配置文件"><a href="#1-2、修改配置文件" class="headerlink" title="1.2、修改配置文件"></a>1.2、修改配置文件</h4><ul><li>修改配置</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">vim命令：yy复制一行，p粘贴</span><br>vim /etc/elasticsearch/elasticsearch.yml<br><span class="hljs-meta prompt_">#</span><span class="language-bash">network.host: 192.168.0.1</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Es服务对外暴露服务的地址</span><br>network.host: 0.0.0.0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">By default Elasticsearch listens <span class="hljs-keyword">for</span> HTTP traffic on the first free port it</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">finds starting at 9200. Set a specific HTTP port here:</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment">#http.port: 9200</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># For more information, consult the network module documentation.</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># --------------------------------- Discovery ----------------------------------</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># Pass an initial list of hosts to perform discovery when this node is started:</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">The default list of hosts is [<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-string">&quot;[::1]&quot;</span>]</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 指定ES集群节点ip</span></span><br>discovery.seed_hosts: [&quot;192.168.10.101&quot;]<br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># Bootstrap the cluster using an initial set of master-eligible nodes:</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment">#cluster.initial_master_nodes: [&quot;node-1&quot;, &quot;node-2&quot;]</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">指定参与master选举的节点</span><br>cluster.initial_master_nodes: [&quot;192.168.10.101&quot;]<br><br></code></pre></td></tr></table></figure><ul><li>启动服务，并测试</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl enable --now elasticsearch<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">cluster_uuid这里不能是<span class="hljs-string">&quot;_na_&quot;</span></span><br>[root@node1-10-101 elasticSearch]# curl 192.168.10.101:9200<br>&#123;<br>  &quot;name&quot; : &quot;node1-10-101&quot;,<br>  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,<br>  &quot;cluster_uuid&quot; : &quot;aT0OcvPFR-Oh8BYdpb-N_A&quot;,<br>  &quot;version&quot; : &#123;<br>    &quot;number&quot; : &quot;7.17.15&quot;,<br>    &quot;build_flavor&quot; : &quot;default&quot;,<br>    &quot;build_type&quot; : &quot;rpm&quot;,<br>    &quot;build_hash&quot; : &quot;0b8ecfb4378335f4689c4223d1f1115f16bef3ba&quot;,<br>    &quot;build_date&quot; : &quot;2023-11-10T22:03:46.987399016Z&quot;,<br>    &quot;build_snapshot&quot; : false,<br>    &quot;lucene_version&quot; : &quot;8.11.1&quot;,<br>    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,<br>    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;<br>  &#125;,<br>  &quot;tagline&quot; : &quot;You Know, for Search&quot;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="1-2-1、服务-na-错误处理"><a href="#1-2-1、服务-na-错误处理" class="headerlink" title="1.2.1、服务_na_错误处理"></a>1.2.1、服务<code>_na_</code>错误处理</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">停止服务，删除相关文件</span><br>systemctl stop elasticsearch.service<br>rm -rf /var/lib/elasticsearch/* /var/log/elasticsearch/* /tmp/*<br><br>systemctl start elasticsearch.service<br>curl 192.168.10.101:9200<br></code></pre></td></tr></table></figure><hr><h3 id="2、群集部署"><a href="#2、群集部署" class="headerlink" title="2、群集部署"></a>2、群集部署</h3><h4 id="2-1、部署"><a href="#2-1、部署" class="headerlink" title="2.1、部署"></a>2.1、部署</h4><ul><li><p>三台机器：192.168.10.101、192.168.10.102、192.168.10.103。</p></li><li><p>所有节点</p></li></ul><blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p /opt/elasticSearch<br>cd /opt/elasticSearch/<br><span class="hljs-meta prompt_"># </span><span class="language-bash">上传RPM包</span><br><br>rpm -ivh elasticsearch-7.17.15-x86_64.rpm<br></code></pre></td></tr></table></figure></blockquote><ul><li>node1：</li></ul><blockquote><p>1）清理node1机器数据，之前单机部署（新机器可不操作）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl stop elasticsearch.service<br>rm -rf /var/lib/elasticsearch/* /var/log/elasticsearch/* /tmp/*<br></code></pre></td></tr></table></figure><p>2）修改配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/elasticsearch/elasticsearch.yml <br>...<br><span class="hljs-meta prompt_"># </span><span class="language-bash">指定ES集群的名称</span><br>cluster.name: liuxx414<br><span class="hljs-meta prompt_"># </span><span class="language-bash">ES服务监听对外暴露服务的地址</span><br>network.host: 0.0.0.0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">指定ES集群的节点IP</span><br>discovery.seed_hosts: [&quot;192.168.10.101&quot;,&quot;192.168.10.102&quot;,&quot;192.168.10.103&quot;]<br><span class="hljs-meta prompt_"># </span><span class="language-bash">指定参与master选举的节点</span><br>cluster.initial_master_nodes: [&quot;192.168.10.101&quot;,&quot;192.168.10.102&quot;,&quot;192.168.10.103&quot;]<br></code></pre></td></tr></table></figure><p>3）将配置分发到node2、node3上</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">scp /etc/elasticsearch/elasticsearch.yml  192.168.10.102:/etc/elasticsearch/elasticsearch.yml<br>scp /etc/elasticsearch/elasticsearch.yml  192.168.10.103:/etc/elasticsearch/elasticsearch.yml<br></code></pre></td></tr></table></figure></blockquote><ul><li>所有节点</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl enable --now elasticsearch<br></code></pre></td></tr></table></figure><h4 id="2-2、验证"><a href="#2-2、验证" class="headerlink" title="2.2、验证"></a>2.2、验证</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@node1-10-101 elasticsearch]# curl 192.168.10.101:9200<br>&#123;<br>  &quot;name&quot; : &quot;node1-10-101&quot;,<br>  &quot;cluster_name&quot; : &quot;liuxx414&quot;,<br>  &quot;cluster_uuid&quot; : &quot;Jrwi8N5YRl2Z24HvUQAFpQ&quot;,<br>  &quot;version&quot; : &#123;<br>    &quot;number&quot; : &quot;7.17.15&quot;,<br>    &quot;build_flavor&quot; : &quot;default&quot;,<br>    &quot;build_type&quot; : &quot;rpm&quot;,<br>    &quot;build_hash&quot; : &quot;0b8ecfb4378335f4689c4223d1f1115f16bef3ba&quot;,<br>    &quot;build_date&quot; : &quot;2023-11-10T22:03:46.987399016Z&quot;,<br>    &quot;build_snapshot&quot; : false,<br>    &quot;lucene_version&quot; : &quot;8.11.1&quot;,<br>    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,<br>    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;<br>  &#125;,<br>  &quot;tagline&quot; : &quot;You Know, for Search&quot;<br>&#125;<br><br>[root@node1-10-101 elasticsearch]# curl 192.168.10.101:9200/_cat/nodes?v<br>ip             heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name<br>192.168.10.102           18          96   0    0.33    0.22     0.10 cdfhilmrstw *      node2-10-102<br>192.168.10.101           20          89   0    0.22    0.19     0.11 cdfhilmrstw -      node1-10-101<br>192.168.10.103           11          96   0    0.10    0.10     0.07 cdfhilmrstw -      node3-10-103<br><br>[root@node2-10-102 elasticSearch]# curl 192.168.10.101:9200/_cluster/health?pretty<br>&#123;<br>  &quot;cluster_name&quot; : &quot;liuxx414&quot;,<br>  &quot;status&quot; : &quot;green&quot;,<br>  &quot;timed_out&quot; : false,<br>  &quot;number_of_nodes&quot; : 3,<br>  &quot;number_of_data_nodes&quot; : 3,<br>  &quot;active_primary_shards&quot; : 2,<br>  &quot;active_shards&quot; : 4,<br>  &quot;relocating_shards&quot; : 0,<br>  &quot;initializing_shards&quot; : 0,<br>  &quot;unassigned_shards&quot; : 0,<br>  &quot;delayed_unassigned_shards&quot; : 0,<br>  &quot;number_of_pending_tasks&quot; : 0,<br>  &quot;number_of_in_flight_fetch&quot; : 0,<br>  &quot;task_max_waiting_in_queue_millis&quot; : 0,<br>  &quot;active_shards_percent_as_number&quot; : 100.0<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2-2-1、集群概念"><a href="#2-2-1、集群概念" class="headerlink" title="2.2.1、集群概念"></a>2.2.1、集群概念</h5><p>1）三台机器选举master节点，最多几台节点在线，集群可以正常访问？</p><ul><li>超过半数以上。 3台必须有 2台在线集群能正常访问。</li></ul><p>2）为什么要超过半数以上？</p><ul><li>防止HA中，选举master出现脑裂。</li></ul><h5 id="2-2-2、端口9200、9300概念"><a href="#2-2-2、端口9200、9300概念" class="headerlink" title="2.2.2、端口9200、9300概念"></a>2.2.2、端口9200、9300概念</h5><ul><li>9200：对外暴露的restful访问端口。</li><li>9300：内部集群通信端口。</li></ul><hr><h3 id="3、二进制集群部署"><a href="#3、二进制集群部署" class="headerlink" title="3、二进制集群部署"></a>3、二进制集群部署</h3><h4 id="3-1、前期准备"><a href="#3-1、前期准备" class="headerlink" title="3.1、前期准备"></a>3.1、前期准备</h4><h5 id="3-1-1、配置集群免密登录和同步脚本"><a href="#3-1-1、配置集群免密登录和同步脚本" class="headerlink" title="3.1.1、配置集群免密登录和同步脚本"></a>3.1.1、配置集群免密登录和同步脚本</h5><blockquote><ul><li>三台机器集群名称修改为</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">hostnamectl set-hostname node10-101<br><br>hostnamectl set-hostname node10-102<br><br>hostnamectl set-hostname node10-103<br></code></pre></td></tr></table></figure><ul><li>node10-101添加hosts域名解析</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt;&gt; /etc/hosts &lt;&lt;&#x27;EOF&#x27;<br>192.168.10.101 node10-101<br>192.168.10.102 node10-102<br>192.168.10.103 node10-103<br>EOF<br></code></pre></td></tr></table></figure><ul><li>node10-101节点上生成密钥对</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh-keygen -t rsa -P &#x27;&#x27; -f ~/.ssh/id_rsa -q<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置所有集群节点的免密登录</span><br>for ((host_id=101;host_id&lt;=103;host_id++));do ssh-copy-id node10-$&#123;host_id&#125;;done<br></code></pre></td></tr></table></figure><ul><li>测试连接</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh &#x27;node10-101&#x27;<br>ssh &#x27;node10-102&#x27;<br>ssh &#x27;node10-103&#x27;<br></code></pre></td></tr></table></figure><ul><li>安装rsync数据同步工具</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum -y install rsync<br></code></pre></td></tr></table></figure><ul><li>node10-101编写同步脚本</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; /usr/local/sbin/data_rsync.sh &lt;&lt;&#x27;EOF&#x27;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>if  [ $# -ne 1 ];then<br>   echo &quot;Usage: $0 /path/to/file(绝对路径)&quot;<br>   exit<br>fi <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">判断文件是否存在</span><br>if [ ! -e $1 ];then<br>    echo &quot;[ $1 ] dir or file not find!&quot;<br>    exit<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">获取父路径</span><br>fullpath=`dirname $1`<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">获取子路径</span><br>basename=`basename $1`<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">进入到父路径</span><br>cd $fullpath<br><br>for ((host_id=102;host_id&lt;=103;host_id++))<br>  do<br>    # 使得终端输出变为绿色<br>    tput setaf 2<br>    echo ===== rsyncing node10-$&#123;host_id&#125;: $basename =====<br>    # 使得终端恢复原来的颜色<br>    tput setaf 7<br>    # 将数据同步到其他两个节点<br>    rsync -apz $basename  `whoami`@node10-$&#123;host_id&#125;:$fullpath<br>    if [ $? -eq 0 ];then<br>      echo &quot;命令执行成功!&quot;<br>    fi<br>done<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod +x /usr/local/sbin/data_rsync.sh<br></code></pre></td></tr></table></figure></blockquote><h4 id="3-2、二进制安装步骤"><a href="#3-2、二进制安装步骤" class="headerlink" title="3.2、二进制安装步骤"></a>3.2、二进制安装步骤</h4><blockquote><ul><li>node10-101上传ES软件包</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@node10-101 ~]# ls<br>anaconda-ks.cfg  elasticsearch-7.17.15-linux-x86_64.tar.gz  time.log<br></code></pre></td></tr></table></figure><ul><li>所有节点：创建运行ES服务的用户</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">node10-101、102、103</span><br>useradd -u 2024 elasticsearch<br></code></pre></td></tr></table></figure><ul><li>node10-101创建ES的工作目录</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -pv /elasticsearch/&#123;data,logs,softwares&#125;/es7<br>chown elasticsearch:elasticsearch -R /elasticsearch/&#123;softwares,data,logs&#125;/es7/<br>ll /elasticsearch/&#123;data,logs,softwares&#125;/es7 -d<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">上面3条命令变一条</span><br>install -d /elasticsearch/&#123;data,logs,softwares&#125;/es7 -o elasticsearch -g elasticsearch<br></code></pre></td></tr></table></figure><ul><li>node10-101解压软件包</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -zvxf elasticsearch-7.17.15-linux-x86_64.tar.gz -C /elasticsearch/softwares/es7/<br><br>[root@node10-101 ~]# ll /elasticsearch/softwares/es7/elasticsearch-7.17.15/<br>总用量 648<br>drwxr-xr-x.  2 root root   4096 11月 11 06:07 bin<br>drwxr-xr-x.  3 root root    210 4月   5 14:16 config<br>drwxr-xr-x.  8 root root     96 11月 11 06:07 jdk<br>drwxr-xr-x.  3 root root   4096 11月 11 06:07 lib<br>-rw-r--r--.  1 root root   3860 11月 11 06:02 LICENSE.txt<br>drwxr-xr-x.  2 root root      6 11月 11 06:05 logs<br>drwxr-xr-x. 61 root root   4096 11月 11 06:07 modules<br>-rw-r--r--.  1 root root 642830 11月 11 06:04 NOTICE.txt<br>drwxr-xr-x.  2 root root      6 11月 11 06:05 plugins<br>-rw-r--r--.  1 root root   2710 11月 11 06:03 README.asciidoc<br></code></pre></td></tr></table></figure><ul><li>node10-101修改ES配置</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi /elasticsearch/softwares/es7/elasticsearch-7.17.15/config/elasticsearch.yml<br>cluster.name: liuxx-es-2024<br>path.data: /elasticsearch/data/es7<br>path.logs: /elasticsearch/logs/es7<br><span class="hljs-meta prompt_"># </span><span class="language-bash">需要自己更换为对应ip</span><br>network.host: 192.168.10.101<br>discovery.seed_hosts: [&quot;node10-101&quot;,&quot;node10-102&quot;,&quot;node10-103&quot;]<br>cluster.initial_master_nodes: [&quot;node10-101&quot;,&quot;node10-102&quot;,&quot;node10-103&quot;]<br></code></pre></td></tr></table></figure><ul><li>node10-101针对ES基础优化</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">配置完退出当前会话</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">文件打开数量上限配置</span><br>cat &gt; /etc/security/limits.d/es7.conf &lt;&lt;&#x27;EOF&#x27;<br>*  soft  nofile  65535<br>*  hard  nofile  131070<br>*  hard  nproc  8192<br>EOF<br><br>[root@node10-101 ~]# ulimit -Sn<br>65535<br>[root@node10-101 ~]# ulimit -Hn<br>131070<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">调整内核虚拟内存映射值</span><br>cat &gt; /etc/sysctl.d/es.conf &lt;&lt;&#x27;EOF&#x27;<br>vm.max_map_count=524288<br>EOF<br><br>[root@node10-101 ~]# sysctl -q vm.max_map_count<br>vm.max_map_count = 262144<br>[root@node10-101 ~]# sysctl -f  /etc/sysctl.d/es.conf<br>vm.max_map_count = 524288<br>[root@node10-101 ~]# sysctl -q vm.max_map_count<br>vm.max_map_count = 524288<br></code></pre></td></tr></table></figure><ul><li>node10-101同步配置</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">data_rsync.sh  /elasticsearch<br><br>data_rsync.sh  /etc/sysctl.d/es.conf<br>data_rsync.sh  /etc/security/limits.d/es7.conf <br>data_rsync.sh  /etc/hosts<br></code></pre></td></tr></table></figure></blockquote><h5 id="3-2-1、简单启动测试"><a href="#3-2-1、简单启动测试" class="headerlink" title="3.2.1、简单启动测试"></a>3.2.1、简单启动测试</h5><ul><li>所有节点：退出会话，使文件打开数量上限配置生效。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">使内核参数生效</span><br>sysctl -f  /etc/sysctl.d/es.conf<br></code></pre></td></tr></table></figure><ul><li>所有节点：后台启动服务</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">su elasticsearch -c &#x27;/elasticsearch/softwares/es7/elasticsearch-7.17.15/bin/elasticsearch -d&#x27;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">报错没有jdk</span><br>[root@node10-101 ~]# su elasticsearch -c &#x27;/elasticsearch/softwares/es7/elasticsearch-7.17.15/bin/elasticsearch -d&#x27;<br>could not find java in bundled JDK at /elasticsearch/softwares/es7/elasticsearch-7.17.15/jdk/bin/java<br><span class="hljs-meta prompt_"># </span><span class="language-bash">有jdk啊</span><br>[root@node10-101 ~]# ll /elasticsearch/softwares/es7/elasticsearch-7.17.15/jdk/bin/java<br>-rwxr-xr-x. 1 root root 12328 11月 11 06:07 /elasticsearch/softwares/es7/elasticsearch-7.17.15/jdk/bin/java<br><span class="hljs-meta prompt_"># </span><span class="language-bash">属组不对，不是elasticsearch 用户</span><br>[root@node10-101 ~]# ll /elasticsearch/<br>总用量 0<br>drwxr-xr-x. 3 root root 17 4月   5 14:14 data<br>drwxr-xr-x. 3 root root 17 4月   5 14:14 logs<br>drwxr-xr-x. 3 root root 17 4月   5 14:14 softwares<br><span class="hljs-meta prompt_"># </span><span class="language-bash">解决方法</span><br>chown elasticsearch:elasticsearch -R /elasticsearch/&#123;softwares,data,logs&#125;/es7/<br></code></pre></td></tr></table></figure><ul><li>查看</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@node10-101 ~]# netstat -tunlp | grep java<br>tcp6       0      0 :::9200                 :::*                    LISTEN      55659/java<br>tcp6       0      0 :::9300                 :::*                    LISTEN      55659/java<br><br>[root@node10-101 ~]# curl http://node10-102:9200<br>&#123;<br>  &quot;name&quot; : &quot;node10-102&quot;,<br>  &quot;cluster_name&quot; : &quot;liuxx-es-2024&quot;,<br>  &quot;cluster_uuid&quot; : &quot;x8n7eXZXRDSSIdDGT3nmHw&quot;,<br>  &quot;version&quot; : &#123;<br>    &quot;number&quot; : &quot;7.17.15&quot;,<br>    &quot;build_flavor&quot; : &quot;default&quot;,<br>    &quot;build_type&quot; : &quot;tar&quot;,<br>    &quot;build_hash&quot; : &quot;0b8ecfb4378335f4689c4223d1f1115f16bef3ba&quot;,<br>    &quot;build_date&quot; : &quot;2023-11-10T22:03:46.987399016Z&quot;,<br>    &quot;build_snapshot&quot; : false,<br>    &quot;lucene_version&quot; : &quot;8.11.1&quot;,<br>    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,<br>    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;<br>  &#125;,<br>  &quot;tagline&quot; : &quot;You Know, for Search&quot;<br>&#125;<br>[root@node10-101 ~]# curl http://node10-103:9200<br>&#123;<br>  &quot;name&quot; : &quot;node10-103&quot;,<br>  &quot;cluster_name&quot; : &quot;liuxx-es-2024&quot;,<br>  &quot;cluster_uuid&quot; : &quot;x8n7eXZXRDSSIdDGT3nmHw&quot;,<br>  &quot;version&quot; : &#123;<br>    &quot;number&quot; : &quot;7.17.15&quot;,<br>    &quot;build_flavor&quot; : &quot;default&quot;,<br>    &quot;build_type&quot; : &quot;tar&quot;,<br>    &quot;build_hash&quot; : &quot;0b8ecfb4378335f4689c4223d1f1115f16bef3ba&quot;,<br>    &quot;build_date&quot; : &quot;2023-11-10T22:03:46.987399016Z&quot;,<br>    &quot;build_snapshot&quot; : false,<br>    &quot;lucene_version&quot; : &quot;8.11.1&quot;,<br>    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,<br>    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;<br>  &#125;,<br>  &quot;tagline&quot; : &quot;You Know, for Search&quot;<br>&#125;<br><br>[root@node10-101 ~]# curl http://node10-101:9200/_cat/nodes<br>192.168.10.102 33 96 5 0.06 0.08 0.07 cdfhilmrstw * node10-102<br>192.168.10.101 22 96 4 0.05 0.07 0.06 cdfhilmrstw - node10-101<br>192.168.10.103 46 96 5 0.14 0.09 0.07 cdfhilmrstw - node10-103<br><br></code></pre></td></tr></table></figure><h5 id="3-2-2、若集群uuid出现-na-状态时"><a href="#3-2-2、若集群uuid出现-na-状态时" class="headerlink" title="3.2.2、若集群uuid出现_na_状态时"></a>3.2.2、若集群uuid出现<code>_na_</code>状态时</h5><ul><li>所有节点操作</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">pkill java<br>rm -rf  /elasticsearch/data/es7/* /elasticsearch/logs/es7/* /tmp/*<br></code></pre></td></tr></table></figure><h4 id="3-3、编写systemctl管理ES服务"><a href="#3-3、编写systemctl管理ES服务" class="headerlink" title="3.3、编写systemctl管理ES服务"></a>3.3、编写systemctl管理ES服务</h4><ul><li>所有节点停止ES服务</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pkill java<br></code></pre></td></tr></table></figure><ul><li>node10-101编写systemctl启动脚本</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; /usr/lib/systemd/system/es7.service &lt;&lt;EOF<br>[Unit]<br>Description= elasticsearch es7<br>After=network.target<br><br>[Service]<br>Type=simple<br>ExecStart=/elasticsearch/softwares/es7/elasticsearch-7.17.15/bin/elasticsearch<br>User=elasticsearch<br>LimitNOFILE=131070<br><br>[Install]<br>WantedBy=multi-user.target<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">同步配置</span><br>data_rsync.sh /usr/lib/systemd/system/es7.service<br></code></pre></td></tr></table></figure><ul><li>所有节点：启动加载脚本</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl daemon-reload<br>systemctl enable --now es7<br></code></pre></td></tr></table></figure><ul><li>查看</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl status es7<br><br>[root@node10-101 ~]# curl http://node10-101:9200/_cat/nodes<br>192.168.10.101 48 96 0 0.21 0.11 0.08 cdfhilmrstw - node10-101<br>192.168.10.103 45 96 0 0.33 0.14 0.09 cdfhilmrstw - node10-103<br>192.168.10.102 16 96 0 0.27 0.12 0.08 cdfhilmrstw * node10-102<br></code></pre></td></tr></table></figure><hr><h4 id="3-4、替换open-jdk"><a href="#3-4、替换open-jdk" class="headerlink" title="3.4、替换open-jdk"></a>3.4、替换open-jdk</h4><ul><li>ES自己使用的是JDK-21</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@node10-101 bin]# /elasticsearch/softwares/es7/elasticsearch-7.17.15/jdk/bin/java -version<br>openjdk version &quot;21.0.1&quot; 2023-10-17<br>OpenJDK Runtime Environment (build 21.0.1+12-29)<br>OpenJDK 64-Bit Server VM (build 21.0.1+12-29, mixed mode, sharing)<br>[root@node10-101 bin]# /elasticsearch/softwares/es7/elasticsearch-7.17.15/jdk/bin/javac -version<br>javac 21.0.1<br></code></pre></td></tr></table></figure><ul><li>node10-101使用Oracle的JDK-8替换</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">上传JDK8</span><br>tar -zxvf jdk-8u291-linux-x64.tar.gz -C /elasticsearch/softwares/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置jdk环境变量</span><br>cat &gt;/etc/profile.d/jdk.sh&lt;&lt;EOF<br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>export JAVA_HOME=/elasticsearch/softwares/jdk1.8.0_291<br>export PATH=\$PATH:\$JAVA_HOME/bin<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">测试</span><br>[root@node10-101 ~]# java -version<br>java version &quot;1.8.0_291&quot;<br>Java(TM) SE Runtime Environment (build 1.8.0_291-b10)<br>Java HotSpot(TM) 64-Bit Server VM (build 25.291-b10, mixed mode)<br>[root@node10-101 ~]# javac -version<br>javac 1.8.0_291<br><br></code></pre></td></tr></table></figure><ul><li>node10-101修改ES的启动脚本</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl stop es7<br><br>cat &gt; /usr/lib/systemd/system/es7.service &lt;&lt;EOF<br>[Unit]<br>Description= elasticsearch es7<br>After=network.target<br><br>[Service]<br>Type=simple<br>Environment=JAVA_HOME=/elasticsearch/softwares/jdk1.8.0_291<br>ExecStart=/elasticsearch/softwares/es7/elasticsearch-7.17.15/bin/elasticsearch<br>User=elasticsearch<br>LimitNOFILE=131070<br><br>[Install]<br>WantedBy=multi-user.target<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl daemon-reload<br>systemctl start es7<br></code></pre></td></tr></table></figure><p>重启下服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl restart es7<br><br>[root@node10-101 ~]# systemctl status es7<br>● es7.service - elasticsearch es7<br>   Loaded: loaded (/usr/lib/systemd/system/es7.service; enabled; vendor preset: disabled)<br>   Active: active (running) since 五 2024-04-05 21:23:32 CST; 34s ago<br> Main PID: 8982 (java)<br>   CGroup: /system.slice/es7.service<br>           ├─8982 /elasticsearch/softwares/jdk1.8.0_291/bin/java -Xshare:auto -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=true -Dfile.encodi...<br>           └─9122 /elasticsearch/softwares/es7/elasticsearch-7.17.15/modules/x-pack-ml/platform/linux-x86_64/bin/controller<br><br>[root@node10-101 ~]# curl http://node10-101:9200<br>&#123;<br>  &quot;name&quot; : &quot;node10-101&quot;,<br>  &quot;cluster_name&quot; : &quot;liuxx-es-2024&quot;,<br>  &quot;cluster_uuid&quot; : &quot;x8n7eXZXRDSSIdDGT3nmHw&quot;,<br>  &quot;version&quot; : &#123;<br>    &quot;number&quot; : &quot;7.17.15&quot;,<br>    &quot;build_flavor&quot; : &quot;default&quot;,<br>    &quot;build_type&quot; : &quot;tar&quot;,<br>    &quot;build_hash&quot; : &quot;0b8ecfb4378335f4689c4223d1f1115f16bef3ba&quot;,<br>    &quot;build_date&quot; : &quot;2023-11-10T22:03:46.987399016Z&quot;,<br>    &quot;build_snapshot&quot; : false,<br>    &quot;lucene_version&quot; : &quot;8.11.1&quot;,<br>    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,<br>    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;<br>  &#125;,<br>  &quot;tagline&quot; : &quot;You Know, for Search&quot;<br>&#125;<br>[root@node10-101 ~]# curl http://node10-101:9200/_cat/nodes<br>192.168.10.103 44 71 0 0.00 0.01 0.05 cdfhilmrstw - node10-103<br>192.168.10.101  9 48 5 0.11 0.13 0.10 cdfhilmrstw - node10-101<br>192.168.10.102 15 71 1 0.01 0.08 0.05 cdfhilmrstw * node10-102<br><br></code></pre></td></tr></table></figure><ul><li>同步到node10-102、103</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">data_rsync.sh /elasticsearch/softwares/jdk1.8.0_291/<br>data_rsync.sh /etc/profile.d/jdk.sh<br>data_rsync.sh /usr/lib/systemd/system/es7.service<br></code></pre></td></tr></table></figure><ul><li>其他节点</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl daemon-reload  &amp;&amp; systemctl restart es7<br><br>[root@node10-102 ~]# systemctl status es7<br>● es7.service - elasticsearch es7<br>   Loaded: loaded (/usr/lib/systemd/system/es7.service; enabled; vendor preset: disabled)<br>   Active: active (running) since 五 2024-04-05 21:27:16 CST; 49s ago<br> Main PID: 2373 (java)<br>   CGroup: /system.slice/es7.service<br>           ├─2373 /elasticsearch/softwares/jdk1.8.0_291/bin/java -Xshare:auto -Des.networkaddress.cache.ttl=60<br>           <br>[root@node10-103 ~]# systemctl status es7<br>● es7.service - elasticsearch es7<br>   Loaded: loaded (/usr/lib/systemd/system/es7.service; enabled; vendor preset: disabled)<br>   Active: active (running) since 五 2024-04-05 21:27:20 CST; 1min 27s ago<br> Main PID: 2472 (java)<br>   CGroup: /system.slice/es7.service<br>           ├─2472 /elasticsearch/softwares/jdk1.8.0_291/bin/java -Xshare:auto -Des.networkaddress.cache.ttl=60<br>           <br>[root@node10-103 ~]# curl http://node10-103:9200/_cat/nodes<br>192.168.10.101 12 56 0 0.04 0.11 0.11 cdfhilmrstw * node10-101<br>192.168.10.103 18 57 0 0.06 0.08 0.06 cdfhilmrstw - node10-103<br>192.168.10.102 11 57 0 0.20 0.23 0.12 cdfhilmrstw - node10-102<br></code></pre></td></tr></table></figure><h5 id="3-4-1、jps小命令"><a href="#3-4-1、jps小命令" class="headerlink" title="3.4.1、jps小命令"></a>3.4.1、jps小命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@node10-101 ~]# jps -l<br>8982 org.elasticsearch.bootstrap.Elasticsearch<br>10655 sun.tools.jps.Jps<br>[root@node10-101 ~]# jps -vl<br>8982 org.elasticsearch.bootstrap.Elasticsearch -Xshare:auto -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dio.netty.allocator.numDirectArenas=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Dlog4j2.formatMsgNoLookups=true -Djava.locale.providers=SPI,JRE -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -Djava.io.tmpdir=/tmp/elasticsearch-8761102379248184159 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=data -XX:ErrorFile=logs/hs_err_pid%p.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:logs/gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=32 -XX:GCLogFileSize=64m -Xms1024m -Xmx1024m -XX:MaxDirectMemorySize=536870912 -Des.path.home=/elasticsearch/softwares/es7/e<br>10685 sun.tools.jps.Jps -Dapplication.home=/elasticsearch/softwares/jdk1.8.0_291 -Xms8m<br><br></code></pre></td></tr></table></figure><hr><h4 id="3-5、修改堆内存大小heap"><a href="#3-5、修改堆内存大小heap" class="headerlink" title="3.5、修改堆内存大小heap"></a>3.5、修改堆内存大小heap</h4><h5 id="3-5-1、堆内存大小推荐设置"><a href="#3-5-1、堆内存大小推荐设置" class="headerlink" title="3.5.1、堆内存大小推荐设置"></a>3.5.1、堆内存大小推荐设置</h5><ul><li>查看当前节点ES的堆内存大小</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@node10-101 ~]# jps -l<br>8982 org.elasticsearch.bootstrap.Elasticsearch<br>10655 sun.tools.jps.Jps<br><br>[root@node10-101 ~]# jmap -heap 8982<br>...<br>Heap Configuration:<br>   MinHeapFreeRatio         = 40<br>   MaxHeapFreeRatio         = 70<br>   MaxHeapSize              = 1073741824 (1024.0MB)<br>   NewSize                  = 174456832 (166.375MB)<br>   MaxNewSize               = 174456832 (166.375MB)<br>   OldSize                  = 899284992 (857.625MB)<br>   NewRatio                 = 2<br>   SurvivorRatio            = 8<br>   MetaspaceSize            = 21807104 (20.796875MB)<br>   CompressedClassSpaceSize = 1073741824 (1024.0MB)<br>   MaxMetaspaceSize         = 17592186044415 MB<br>   G1HeapRegionSize         = 0 (0.0MB)<br>...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看命令</span><br>[root@node10-101 ~]# jmap -heap `jps | awk &#x27;/Elasticsearch/&#123;print $1&#125;&#x27;` | grep &#x27;HeapSize&#x27;<br>   MaxHeapSize              = 1073741824 (1024.0MB)<br><br></code></pre></td></tr></table></figure><ul><li>设置：</li></ul><blockquote><p>堆内存最大不要超过32G。</p><p>设置堆内存为宿主机的一半，假设：服务器 32G设置16G，64G设置32G，128G设置32G。</p></blockquote><h5 id="3-5-2、修改配置"><a href="#3-5-2、修改配置" class="headerlink" title="3.5.2、修改配置"></a>3.5.2、修改配置</h5><ul><li>node10-101操作</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /elasticsearch/softwares/es7/elasticsearch-7.17.15/config/jvm.options<br>...<br>-Xms256m<br>-Xmx256m<br>...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">重启服务</span><br>systemctl restart es7<br><br>[root@node10-101 ~]# jmap -heap `jps | awk &#x27;/Elasticsearch/&#123;print $1&#125;&#x27;` | grep &#x27;HeapSize&#x27;<br>   MaxHeapSize              = 268435456 (256.0MB)<br><br></code></pre></td></tr></table></figure><ul><li>node10-101同步到其他节点</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">data_rsync.sh /elasticsearch/softwares/es7/elasticsearch-7.17.15/config/jvm.options<br></code></pre></td></tr></table></figure><ul><li>其他节点操作</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@node10-102 ~]# systemctl restart es7<br>[root@node10-102 ~]# source /etc/profile.d/jdk.sh<br>[root@node10-102 ~]#<br>[root@node10-102 ~]# jmap -heap `jps | awk &#x27;/Elasticsearch/&#123;print $1&#125;&#x27;` | grep &#x27;HeapSize&#x27;<br>   MaxHeapSize              = 268435456 (256.0MB)<br><br><br>[root@node10-103 ~]# systemctl restart es7<br>[root@node10-103 ~]# source /etc/profile.d/jdk.sh<br>[root@node10-103 ~]#<br>[root@node10-103 ~]#<br>[root@node10-103 ~]# jmap -heap `jps | awk &#x27;/Elasticsearch/&#123;print $1&#125;&#x27;` | grep &#x27;HeapSize&#x27;<br>   MaxHeapSize              = 268435456 (256.0MB)<br><br></code></pre></td></tr></table></figure><hr><h4 id="3-6、集群状态查看命令"><a href="#3-6、集群状态查看命令" class="headerlink" title="3.6、集群状态查看命令"></a>3.6、集群状态查看命令</h4><ul><li>节点状态</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@node10-102 ~]# curl http://node10-102:9200/_cat/health<br>1712325347 13:55:47 liuxx-es-2024 green 3 3 4 2 0 0 0 0 - 100.0%<br>[root@node10-102 ~]# curl http://node10-103:9200/_cat/health<br>1712325353 13:55:53 liuxx-es-2024 green 3 3 4 2 0 0 0 0 - 100.0%<br>[root@node10-102 ~]# curl http://node10-101:9200/_cat/health<br>1712325357 13:55:57 liuxx-es-2024 green 3 3 4 2 0 0 0 0 - 100.0%<br><br></code></pre></td></tr></table></figure><ul><li>集群状态</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">安装jq</span><br>yum install epel-release <br>yum -y install jq<br><br>[root@node10-102 ~]# curl http://node10-101:9200/_cluster/health | jq<br><span class="hljs-meta prompt_">  % </span><span class="language-bash">Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100   389  100   389    0     0  40319      0 --:--:-- --:--:-- --:--:-- 43222<br>&#123;<br>  &quot;cluster_name&quot;: &quot;liuxx-es-2024&quot;,<br>  &quot;status&quot;: &quot;green&quot;,<br>  &quot;timed_out&quot;: false,<br>  &quot;number_of_nodes&quot;: 3,<br>  &quot;number_of_data_nodes&quot;: 3,<br>  &quot;active_primary_shards&quot;: 2,<br>  &quot;active_shards&quot;: 4,<br>  &quot;relocating_shards&quot;: 0,<br>  &quot;initializing_shards&quot;: 0,<br>  &quot;unassigned_shards&quot;: 0,<br>  &quot;delayed_unassigned_shards&quot;: 0,<br>  &quot;number_of_pending_tasks&quot;: 0,<br>  &quot;number_of_in_flight_fetch&quot;: 0,<br>  &quot;task_max_waiting_in_queue_millis&quot;: 0,<br>  &quot;active_shards_percent_as_number&quot;: 100<br>&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">2&gt;/dev/null 将错误输出指向 /dev/null (不要错误输出)</span><br>[root@node10-102 ~]# curl http://node10-101:9200/_cluster/health 2&gt;/dev/null | jq<br>&#123;<br>  &quot;cluster_name&quot;: &quot;liuxx-es-2024&quot;,<br>  &quot;status&quot;: &quot;green&quot;,<br>  &quot;timed_out&quot;: false,<br>  &quot;number_of_nodes&quot;: 3,<br>  &quot;number_of_data_nodes&quot;: 3,<br>  &quot;active_primary_shards&quot;: 2,<br>  &quot;active_shards&quot;: 4,<br>  &quot;relocating_shards&quot;: 0,<br>  &quot;initializing_shards&quot;: 0,<br>  &quot;unassigned_shards&quot;: 0,<br>  &quot;delayed_unassigned_shards&quot;: 0,<br>  &quot;number_of_pending_tasks&quot;: 0,<br>  &quot;number_of_in_flight_fetch&quot;: 0,<br>  &quot;task_max_waiting_in_queue_millis&quot;: 0,<br>  &quot;active_shards_percent_as_number&quot;: 100<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3-7、恢复初始化三集群"><a href="#3-7、恢复初始化三集群" class="headerlink" title="3.7、恢复初始化三集群"></a>3.7、恢复初始化三集群</h4><ul><li>所有机器操作</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl stop es7<br>systemctl stop kibana<br><br>rm -rf  /elasticsearch/data/es7/* /elasticsearch/logs/es7/* /tmp/*<br></code></pre></td></tr></table></figure><ul><li>node10-101</li></ul><blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /elasticsearch/softwares/es7/elasticsearch-7.17.15/config/elasticsearch.yml<br>cluster.name: liuxx-es-2024<br>path.data: /elasticsearch/data/es7<br>path.logs: /elasticsearch/logs/es7<br>network.host: 0.0.0.0<br>discovery.seed_hosts: [&quot;node10-101&quot;,&quot;node10-102&quot;,&quot;node10-103&quot;]<br>cluster.initial_master_nodes: [&quot;node10-101&quot;,&quot;node10-102&quot;,&quot;node10-103&quot;]<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">同步node10-102、node10-103</span><br>data_rsync.sh /elasticsearch/softwares/es7/elasticsearch-7.17.15/config/elasticsearch.yml<br></code></pre></td></tr></table></figure></blockquote><ul><li>重新启动</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl restart es7<br>systemctl restart kibana<br></code></pre></td></tr></table></figure><hr><h3 id="4、ES常见概念"><a href="#4、ES常见概念" class="headerlink" title="4、ES常见概念"></a>4、ES常见概念</h3><h4 id="4-1、集群同步机制"><a href="#4-1、集群同步机制" class="headerlink" title="4.1、集群同步机制"></a>4.1、集群同步机制</h4><img src="ElasticSearch.assets/image-20240406165706121.png" alt="image-20240406165706121" style="zoom:80%;" /><ul><li><p>集群颜色</p><p>green：代表所有的主分片和副本分片均正常工作。</p><p>yellow：表示有部分副本分片不正常工作。</p><p>red：表示有部分主分片不正常工作。</p></li></ul><h4 id="4-2、索引index"><a href="#4-2、索引index" class="headerlink" title="4.2、索引index"></a>4.2、索引index</h4><ul><li><p>用户写入ES集群的逻辑单元。</p><p>（相当于MySQL的库）动词：索引一条数据，插入一条数据</p></li><li><p>分片shard：一个索引最少一个分片。<strong>作用是将索引的数据分布式的方式存储在ES集群。</strong></p><p>副本replica：一个分片可以有0个或多个副本。为同一个分片数据提供冗余。</p></li></ul><p>（主分片primary shard和副本分片replica shard区别？主分片可以用于读写RW，副本分片仅能用于读RO-read only）</p><h5 id="4-2-0、倒排索引"><a href="#4-2-0、倒排索引" class="headerlink" title="4.2.0、倒排索引"></a>4.2.0、倒排索引</h5><ul><li>正向索引： 传统数据库MySQL，采用正向索引B+ tree。如：t_goods表基于id创建索引。</li></ul><blockquote><p>会形成一个B+ tree</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs lasso">idtitle  price<br><span class="hljs-number">1</span>小米手机  <span class="hljs-number">3499</span><br><span class="hljs-number">2</span>华为手机  <span class="hljs-number">4999</span><br><span class="hljs-number">3</span>华为小米充电器 <span class="hljs-number">49</span><br><span class="hljs-number">4</span>小米手环  <span class="hljs-number">299</span><br><span class="hljs-params">...</span><span class="hljs-params">...</span><br></code></pre></td></tr></table></figure><p>如果要给title加索引，搜索手机：</p><p>模糊匹配：会逐条扫描数据，判断是否包含手，有就存入结果集，没有就丢弃。</p></blockquote><ul><li>倒排索引：</li></ul><p>会生成一个新的表，包含：</p><p>1、文档document：每条数据就是一个文档。</p><p>2、词条term：对文档中内容分词，得到的词语就是词条（词条不能重复）。</p><p>如：搜索小米手机时，会把小米和手机分开，存入词条，并记录id。</p><blockquote><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs applescript">词条term文档<span class="hljs-built_in">id</span><br>小米<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span><br>手机<span class="hljs-number">1</span>,<span class="hljs-number">2</span><br>华为<span class="hljs-number">2</span>,<span class="hljs-number">3</span><br>充电器    <span class="hljs-number">3</span><br>手环<span class="hljs-number">4</span><br></code></pre></td></tr></table></figure></blockquote><img src="ElasticSearch.assets/image-20240414152952792.png" alt="image-20240414152952792" style="zoom:80%;" /><h5 id="4-2-1、type"><a href="#4-2-1、type" class="headerlink" title="4.2.1、type"></a>4.2.1、type</h5><ul><li><p>type：类型。（表）</p><p>可以定义一个、多个。但是ES8.0后已移除。</p></li><li><p>为什么要移除？</p><p>在ES中不同type下名称相同的filed，最终在Lucene中处理方式是一样的。</p><p>（两个不同type下的，两个user_name，在ES同一个索引下会被认为是同一个filed，你必须在两个不同type中定义相同filed映射）</p><p>如果不同type，相同字段名称，就会出现处理冲突，导致Lucene处理效率下降。</p><p>去掉type能够使数据，独立存储在index，即使有相同字段名也不会冲突，提高ES处理效率。</p></li></ul><h5 id="4-2-1、document"><a href="#4-2-1、document" class="headerlink" title="4.2.1、document"></a>4.2.1、document</h5><ul><li><p>文档，数据，为表中的内容，JSON格式。</p><p>保存在某个索引下的，某种类型的数据。</p></li></ul><hr><h3 id="5、索引管理"><a href="#5、索引管理" class="headerlink" title="5、索引管理"></a>5、索引管理</h3><h4 id="5-1、查看索引"><a href="#5-1、查看索引" class="headerlink" title="5.1、查看索引"></a>5.1、查看索引</h4><h5 id="5-1-1、查看所有索引"><a href="#5-1-1、查看所有索引" class="headerlink" title="5.1.1、查看所有索引"></a>5.1.1、查看所有索引</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">GET <br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">10.101</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/_cat/i</span>ndices<br><br><span class="hljs-comment"># 参数解释</span><br>GET <br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">10.101</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/_cat/i</span>ndices?v<br></code></pre></td></tr></table></figure><h4 id="5-2、创建索引"><a href="#5-2、创建索引" class="headerlink" title="5.2、创建索引"></a>5.2、创建索引</h4><h5 id="5-2-0、创建索引规范"><a href="#5-2-0、创建索引规范" class="headerlink" title="5.2.0、创建索引规范"></a>5.2.0、创建索引规范</h5><p>1）索引名不要以<code>.</code> <code>_</code> 开头（点：隐藏索引，下划线：保留索引）。</p><p>2）索引名称不能出现大写，必须小写。</p><p>3）生成环境中禁止避免使用通配符，尤其是删除操作。</p><h5 id="5-2-1、创建默认索引"><a href="#5-2-1、创建默认索引" class="headerlink" title="5.2.1、创建默认索引"></a>5.2.1、创建默认索引</h5><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dts">PUT <br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/users</span><br></code></pre></td></tr></table></figure><h5 id="5-2-2、创建指定分片和副本"><a href="#5-2-2、创建指定分片和副本" class="headerlink" title="5.2.2、创建指定分片和副本"></a>5.2.2、创建指定分片和副本</h5><ul><li>创建三个分片</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts">PUT <br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/users-shard</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-string">&quot;settings&quot;</span>: <span class="hljs-punctuation">&#123;</span><br><span class="hljs-string">&quot;number_of_shards&quot;</span>: <span class="hljs-number">3</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>创建三个分片，0个副本（分片不能设置为0）</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dts">PUT <br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/users-shard-1</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-string">&quot;settings&quot;</span>: <span class="hljs-punctuation">&#123;</span><br><span class="hljs-string">&quot;number_of_shards&quot;</span>: <span class="hljs-number">5</span>,<br><span class="hljs-string">&quot;number_of_replicas&quot;</span>: <span class="hljs-number">3</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><blockquote><p>注意：三个集群中：分片数量为5，副本分片为2。（主分片&#x3D;1 + 副本分片&#x3D;2 &#x3D; 3）集群状态没有问题。</p><p>但是当分片数量5，副本分片为3，（主分片&#x3D;1 + 副本分片&#x3D;3 &#x3D; 4 ）超过集群数量了，可以创建，但是集群状态为yellow，因为有副本分片没有节点存储。</p></blockquote><h4 id="5-3、修改索引"><a href="#5-3、修改索引" class="headerlink" title="5.3、修改索引"></a>5.3、修改索引</h4><h5 id="5-3-1、修改副本"><a href="#5-3-1、修改副本" class="headerlink" title="5.3.1、修改副本"></a>5.3.1、修改副本</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">PUT <br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">10.101</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/users-shard-1/</span>_setting<br>&#123;<br><span class="hljs-string">&quot;number_of_replicas&quot;</span>: <span class="hljs-number">2</span><br>&#125;<br></code></pre></td></tr></table></figure><p>注意：分片数量无法修改的，副本数量可以修改。</p><h4 id="5-4、删除索引"><a href="#5-4、删除索引" class="headerlink" title="5.4、删除索引"></a>5.4、删除索引</h4><h5 id="5-4-1、删除单个索引"><a href="#5-4-1、删除单个索引" class="headerlink" title="5.4.1、删除单个索引"></a>5.4.1、删除单个索引</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">DELETE <br>http://192.168.10.101:9200/users-shard-1<br></code></pre></td></tr></table></figure><h5 id="5-4-2、删除多个索引"><a href="#5-4-2、删除多个索引" class="headerlink" title="5.4.2、删除多个索引"></a>5.4.2、删除多个索引</h5><ul><li>基于通配符删除多个</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">DELETE <br>http://192.168.10.101:9200/users-shard-*<br></code></pre></td></tr></table></figure><hr><h4 id="5-5、索引别名"><a href="#5-5、索引别名" class="headerlink" title="5.5、索引别名"></a>5.5、索引别名</h4><ul><li>创建</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dts">POST<br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/_aliases</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;actions&quot;</span>: [<br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-string">&quot;add&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;liuxx-2023&quot;</span>,<br>                <span class="hljs-string">&quot;alias&quot;</span>: <span class="hljs-string">&quot;2023&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span>,<br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-string">&quot;add&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;liuxx-2023&quot;</span>,<br>                <span class="hljs-string">&quot;alias&quot;</span>: <span class="hljs-string">&quot;二零二三&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span>,<br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-string">&quot;add&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;liuxx-2024&quot;</span>,<br>                <span class="hljs-string">&quot;alias&quot;</span>: <span class="hljs-string">&quot;202304&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    ]<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>删除</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dts">POST<br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/_aliases</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;actions&quot;</span>: [<br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-string">&quot;remove&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;liuxx-2023&quot;</span>,<br>                <span class="hljs-string">&quot;alias&quot;</span>: <span class="hljs-string">&quot;2023&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    ]<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>查询</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dts">GET<br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/_aliases</span><br></code></pre></td></tr></table></figure><hr><h4 id="5-6、禁用和启用索引"><a href="#5-6、禁用和启用索引" class="headerlink" title="5.6、禁用和启用索引"></a>5.6、禁用和启用索引</h4><ul><li>禁用：关闭索引</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span><br><span class="hljs-attribute">http</span>://<span class="hljs-number">192.168.10.101:9200</span>/liuxx-<span class="hljs-number">2023</span>/_close<br></code></pre></td></tr></table></figure><ul><li>启动：打开索引</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">POST<br>http://192.168.10.101:9200/liuxx-2023/_open<br></code></pre></td></tr></table></figure><hr><h4 id="5-7、索引模版template"><a href="#5-7、索引模版template" class="headerlink" title="5.7、索引模版template"></a>5.7、索引模版template</h4><ul><li>创建索引的一种方式，用户可以根据需求自定义对应的索引模版。</li></ul><h5 id="5-7-1、创建索引模版"><a href="#5-7-1、创建索引模版" class="headerlink" title="5.7.1、创建索引模版"></a>5.7.1、创建索引模版</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs awk">POST<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">10.101</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/_template/</span>liuxx-template-<span class="hljs-number">2024</span><br>&#123;<br>    <span class="hljs-string">&quot;index_patterns&quot;</span>: [<br>        <span class="hljs-string">&quot;liuxx-template*&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;index&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;number_of_shards&quot;</span>: <span class="hljs-number">3</span>,<br>            <span class="hljs-string">&quot;number_of_replicas&quot;</span>: <span class="hljs-number">1</span><br>        &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;properties&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;ip_addr&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ip&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;access_time&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;date&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;address&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span> :<span class="hljs-string">&quot;text&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;name&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="5-7-2、查询单个索引模版"><a href="#5-7-2、查询单个索引模版" class="headerlink" title="5.7.2、查询单个索引模版"></a>5.7.2、查询单个索引模版</h5><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span><br><span class="hljs-attribute">http</span>://<span class="hljs-number">192.168.10.101:9200</span>/_template/liuxx-template-<span class="hljs-number">2024</span><br></code></pre></td></tr></table></figure><h5 id="5-7-3、查看所有索引模版"><a href="#5-7-3、查看所有索引模版" class="headerlink" title="5.7.3、查看所有索引模版"></a>5.7.3、查看所有索引模版</h5><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dts">GET<br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/_template</span><br></code></pre></td></tr></table></figure><h5 id="5-7-4、删除索引模版"><a href="#5-7-4、删除索引模版" class="headerlink" title="5.7.4、删除索引模版"></a>5.7.4、删除索引模版</h5><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">DELETE</span><br><span class="hljs-attribute">http</span>://<span class="hljs-number">192.168.10.101:9200</span>/_template/liuxx-template-<span class="hljs-number">2024</span><br></code></pre></td></tr></table></figure><h5 id="5-7-5、创建索引"><a href="#5-7-5、创建索引" class="headerlink" title="5.7.5、创建索引"></a>5.7.5、创建索引</h5><ul><li>指定了索引前缀liuxx-template</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">PUT</span><br><span class="hljs-attribute">http</span>://<span class="hljs-number">192.168.10.101:9200</span>/liuxx-template-<span class="hljs-number">2024</span>-<span class="hljs-number">001</span><br></code></pre></td></tr></table></figure><hr><h3 id="6、JSON格式"><a href="#6、JSON格式" class="headerlink" title="6、JSON格式"></a>6、JSON格式</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>）字符串： <span class="hljs-string">&quot;string&quot;</span> <span class="hljs-string">&quot;helloWorld&quot;</span> <span class="hljs-string">&quot;中文&quot;</span><br><span class="hljs-attribute">2</span>）数字：<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span><br><span class="hljs-attribute">3</span>）布尔值：true false<br><span class="hljs-attribute">4</span>）空值：null<br><br><span class="hljs-attribute">5</span>）数组：[<span class="hljs-string">&quot;oldgirl&quot;</span>,<span class="hljs-string">&quot;拜拜&quot;</span>,<span class="hljs-number">1024</span>,ture,&#123;<span class="hljs-string">&quot;school&quot;</span>:<span class="hljs-string">&quot;oldgirl&quot;</span>,<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;DBA-2024&quot;</span>&#125;]<br><span class="hljs-attribute">6</span>）对象：&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;liuxx&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">28</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;江苏苏州&quot;</span>,<span class="hljs-string">&quot;hobby&quot;</span>:[<span class="hljs-string">&quot;eat&quot;</span>,<span class="hljs-string">&quot;play&quot;</span>,<span class="hljs-string">&quot;sleep&quot;</span>],<span class="hljs-string">&quot;other&quot;</span>:<span class="hljs-string">&quot;null&quot;</span>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="7、文档管理"><a href="#7、文档管理" class="headerlink" title="7、文档管理"></a>7、文档管理</h3><ul><li>数据</li></ul><h4 id="7-1、新增文档"><a href="#7-1、新增文档" class="headerlink" title="7.1、新增文档"></a>7.1、新增文档</h4><h5 id="7-1-1、创建文档-不指定id"><a href="#7-1-1、创建文档-不指定id" class="headerlink" title="7.1.1、创建文档-不指定id"></a>7.1.1、创建文档-不指定id</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">POST<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">10.101</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/liuxx-2024/</span>_doc<br>&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;张三&quot;</span>,<br>    <span class="hljs-string">&quot;hobby&quot;</span>: [<br>        <span class="hljs-string">&quot;play&quot;</span>,<br>        <span class="hljs-string">&quot;eat&quot;</span>,<br>        <span class="hljs-string">&quot;sleep&quot;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="7-1-2、创建文档-指定id"><a href="#7-1-2、创建文档-指定id" class="headerlink" title="7.1.2、创建文档-指定id"></a>7.1.2、创建文档-指定id</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs awk">POST<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">10.101</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/liuxx-2024/</span>_doc/<span class="hljs-number">1001</span><br>&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;张三疯&quot;</span>,<br>    <span class="hljs-string">&quot;hobby&quot;</span>: [<br>        <span class="hljs-string">&quot;sing&quot;</span>,<br>        <span class="hljs-string">&quot;dance&quot;</span>,<br>        <span class="hljs-string">&quot;rap&quot;</span>,<br>        <span class="hljs-string">&quot;basketlball&quot;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="7-2、更新文档"><a href="#7-2、更新文档" class="headerlink" title="7.2、更新文档"></a>7.2、更新文档</h4><h5 id="7-2-1、全量更新"><a href="#7-2-1、全量更新" class="headerlink" title="7.2.1、全量更新"></a>7.2.1、全量更新</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">POST<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">10.101</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/liuxx-2024/</span>_doc/<span class="hljs-number">1001</span><br>&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;张三疯&quot;</span>,<br>    <span class="hljs-string">&quot;hobby&quot;</span>: [<br>        <span class="hljs-string">&quot;sing&quot;</span>,<br>        <span class="hljs-string">&quot;dance&quot;</span>,<br>        <span class="hljs-string">&quot;rap&quot;</span>,<br>        <span class="hljs-string">&quot;basketlball&quot;</span>,<br>        <span class="hljs-string">&quot;ctrl&quot;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="7-2-2、局部更新数据"><a href="#7-2-2、局部更新数据" class="headerlink" title="7.2.2、局部更新数据"></a>7.2.2、局部更新数据</h5><ul><li>没有的字段直接添加，有字段的数据覆盖。</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">POST<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">10.101</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/liuxx-2024/</span>_doc<span class="hljs-regexp">/1001/</span>_update<br>&#123;<br>    <span class="hljs-string">&quot;doc&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">22</span>,<br>        <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;张三丰&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="7-3、查看文档数据"><a href="#7-3、查看文档数据" class="headerlink" title="7.3、查看文档数据"></a>7.3、查看文档数据</h4><ul><li>查看所有</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span><br><span class="hljs-attribute">http</span>://<span class="hljs-number">192.168.10.101:9200</span>/liuxx-<span class="hljs-number">2024</span>/_search<br></code></pre></td></tr></table></figure><h4 id="7-4、删除文档"><a href="#7-4、删除文档" class="headerlink" title="7.4、删除文档"></a>7.4、删除文档</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">DELETE</span><br><span class="hljs-attribute">http</span>://<span class="hljs-number">192.168.10.101:9200</span>/liuxx-<span class="hljs-number">2024</span>/_doc/<span class="hljs-number">478</span>Pt44B-ijSpFHPFabQ<br></code></pre></td></tr></table></figure><hr><h4 id="7-5、批量操作"><a href="#7-5、批量操作" class="headerlink" title="7.5、批量操作"></a>7.5、批量操作</h4><h5 id="7-5-1、-批量新增"><a href="#7-5-1、-批量新增" class="headerlink" title="7.5.1、 批量新增"></a>7.5.1、 批量新增</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs stylus">POST<br>http:<span class="hljs-comment">//192.168.10.101:9200/_bulk</span><br>&#123; <span class="hljs-string">&quot;create&quot;</span>: &#123; <span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;liuxx-2024&quot;</span>&#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;zhangsan&quot;</span>,<span class="hljs-string">&quot;hobby&quot;</span>:<span class="hljs-selector-attr">[<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;pyhton&quot;</span>]</span> &#125;<br>&#123; <span class="hljs-string">&quot;create&quot;</span>: &#123; <span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;liuxx-2024&quot;</span>&#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;lisi&quot;</span>,<span class="hljs-string">&quot;hobby&quot;</span>:<span class="hljs-selector-attr">[<span class="hljs-string">&quot;vue3&quot;</span>,<span class="hljs-string">&quot;javascript&quot;</span>]</span> &#125;<br>&#123; <span class="hljs-string">&quot;create&quot;</span>: &#123; <span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;liuxx-2024&quot;</span>,<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-number">1002</span>&#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;wangwu&quot;</span>,<span class="hljs-string">&quot;hobby&quot;</span>:<span class="hljs-selector-attr">[<span class="hljs-string">&quot;springboot&quot;</span>,<span class="hljs-string">&quot;mybatis&quot;</span>]</span> &#125;<br>&#123; <span class="hljs-string">&quot;create&quot;</span>: &#123; <span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;liuxx-2024&quot;</span>,<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-number">1003</span>&#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;zhaoliu&quot;</span>,<span class="hljs-string">&quot;hobby&quot;</span>:<span class="hljs-selector-attr">[<span class="hljs-string">&quot;elasticsearch&quot;</span>,<span class="hljs-string">&quot;kafka&quot;</span>]</span> &#125;<br><br></code></pre></td></tr></table></figure><p>注意：批量操作传递json数据，最后一个结束需要换行。</p><h5 id="7-5-2、批量修改"><a href="#7-5-2、批量修改" class="headerlink" title="7.5.2、批量修改"></a>7.5.2、批量修改</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">POST<br>http://192.168.10.101:9200/_bulk<br>&#123; &quot;update&quot; : &#123;&quot;_id&quot; : &quot;1002&quot;, &quot;_index&quot; : &quot;liuxx-2024&quot;&#125; &#125;<br>&#123; &quot;doc&quot; : &#123;&quot;name&quot; : &quot;张三&quot;&#125; &#125;<br>&#123; &quot;update&quot; : &#123;&quot;_id&quot; : &quot;1003&quot;, &quot;_index&quot; : &quot;liuxx-2024&quot;&#125; &#125;<br>&#123; &quot;doc&quot; : &#123;&quot;name&quot; : &quot;李四&quot;&#125; &#125;<br><br></code></pre></td></tr></table></figure><h5 id="7-5-3、批量删除"><a href="#7-5-3、批量删除" class="headerlink" title="7.5.3、批量删除"></a>7.5.3、批量删除</h5><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts">POST<br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/_bulk</span><br><span class="hljs-punctuation">&#123;</span> <span class="hljs-string">&quot;delete&quot;</span> : <span class="hljs-punctuation">&#123;</span> <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;liuxx-2024&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1003&quot;</span> <span class="hljs-punctuation">&#125;</span> <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span> <span class="hljs-string">&quot;delete&quot;</span> : <span class="hljs-punctuation">&#123;</span> <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;liuxx-2024&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1002&quot;</span> <span class="hljs-punctuation">&#125;</span> <span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure><h5 id="7-5-4、批量查询"><a href="#7-5-4、批量查询" class="headerlink" title="7.5.4、批量查询"></a>7.5.4、批量查询</h5><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs dts">POST<br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/_mget</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;docs&quot;</span>: [<br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-string">&quot;_index&quot;</span>:<span class="hljs-string">&quot;liuxx-2024&quot;</span>,<br>            <span class="hljs-string">&quot;_id&quot;</span>: <span class="hljs-string">&quot;1002&quot;</span><br>        <span class="hljs-punctuation">&#125;</span>,<br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;liuxx-2024&quot;</span>,<br>            <span class="hljs-string">&quot;_id&quot;</span>: <span class="hljs-string">&quot;1003&quot;</span> <br>        <span class="hljs-punctuation">&#125;</span><br>    ]<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><hr><h3 id="8、自定义数据类型mapping"><a href="#8、自定义数据类型mapping" class="headerlink" title="8、自定义数据类型mapping"></a>8、自定义数据类型mapping</h3><h4 id="8-1、mapping映射属性介绍"><a href="#8-1、mapping映射属性介绍" class="headerlink" title="8.1、mapping映射属性介绍"></a>8.1、mapping映射属性介绍</h4><ul><li>mapping是对索引中文档的约束。</li></ul><p>常见mapping属性有：</p><blockquote><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1</span>）<span class="hljs-keyword">type</span>：字段数据类型<br>字符串：<br> <span class="hljs-type">text</span>（可分词的文本）<br> keyword-关键字，精确值：如-品牌、国家、email、ip 不可拆分<br> <br><br>数值：<br> long、<span class="hljs-type">integer</span>、short、byte、<span class="hljs-type">double</span>、<span class="hljs-type">float</span> <br><br>布尔：<span class="hljs-type">boolean</span><br><br>日期：<span class="hljs-type">date</span><br><br>对象：<span class="hljs-keyword">object</span><br>&quot;name&quot;:&#123;<br>&quot;firstName&quot;:&quot;赵&quot;,<br>&quot;lastName&quot;:&quot;云&quot;<br>&#125;<br><br>没有数组，但是可以传入多个值： <br>&quot;score&quot;:[<span class="hljs-number">91.2</span>, <span class="hljs-number">99.5</span>, <span class="hljs-number">89.3</span>]<br><br><span class="hljs-number">2</span>）<span class="hljs-keyword">index</span>：是否创建索引，默认为<span class="hljs-keyword">true</span>。<span class="hljs-keyword">false</span>不能被检索<br><br><span class="hljs-number">3</span>）analyzer: 分词<br><br><span class="hljs-number">4</span>）properties: 该字段的子字段<br></code></pre></td></tr></table></figure></blockquote><h5 id="8-1-1、创建索引并指定映射属性"><a href="#8-1-1、创建索引并指定映射属性" class="headerlink" title="8.1.1、创建索引并指定映射属性"></a>8.1.1、创建索引并指定映射属性</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT /heima<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;info&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>        <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_smart&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;email&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span>,<br>        <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-literal">false</span><br>      &#125;,<br>      <span class="hljs-string">&quot;name&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;object&quot;</span>,<br>        <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;firstName&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span><br>          &#125;,<br>          <span class="hljs-string">&quot;lastName&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="8-1-1-1、索引中映射属性不能修改"><a href="#8-1-1-1、索引中映射属性不能修改" class="headerlink" title="8.1.1.1、索引中映射属性不能修改"></a>8.1.1.1、索引中映射属性不能修改</h6><ul><li>不能修改的，只能重新创建，但是可以添加新的字段：(字段名必须全新的)</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">PUT <span class="hljs-regexp">/索引名/</span>_mapping<br>&#123;<br><span class="hljs-string">&quot;properties&quot;</span>:&#123;<br><span class="hljs-string">&quot;新字段名&quot;</span>:&#123;<br><span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;integer&quot;</span><br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="8-1-2、删除"><a href="#8-1-2、删除" class="headerlink" title="8.1.2、删除"></a>8.1.2、删除</h5><ul><li>删除映射关系，就是直接删除索引</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">DELETE</span><br><span class="hljs-attribute">http</span>://<span class="hljs-number">192.168.10.101:9200</span>/liuxx-<span class="hljs-number">2024</span>-ip<br></code></pre></td></tr></table></figure><hr><h4 id="8-2、ip案例操作"><a href="#8-2、ip案例操作" class="headerlink" title="8.2、ip案例操作"></a>8.2、ip案例操作</h4><h5 id="8-2-1、创建索引时指定映射关系"><a href="#8-2-1、创建索引时指定映射关系" class="headerlink" title="8.2.1、创建索引时指定映射关系"></a>8.2.1、创建索引时指定映射关系</h5><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dts">PUT<br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/liuxx-2024-ip</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;mappings&quot;</span>:<span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-string">&quot;properties&quot;</span>:<span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-string">&quot;ip_addr&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;ip&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span>,<br>    <span class="hljs-string">&quot;settings&quot;</span>:<span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-string">&quot;number_of_shards&quot;</span>: <span class="hljs-number">3</span>,<br>        <span class="hljs-string">&quot;number_of_replicas&quot;</span>: <span class="hljs-number">1</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><strong>注意：</strong></p><ul><li>如果不指定映射关系就直接创建数据，”ip_addr”会变成keyword。</li></ul><h5 id="8-2-2、批量创建数据"><a href="#8-2-2、批量创建数据" class="headerlink" title="8.2.2、批量创建数据"></a>8.2.2、批量创建数据</h5><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">POST<br>http://192.168.10.101:9200/_bulk<br>&#123; &quot;<span class="hljs-keyword">create</span><span class="hljs-string">&quot;: &#123; &quot;</span>_index<span class="hljs-string">&quot;: &quot;</span>liuxx<span class="hljs-number">-2024</span>-ip<span class="hljs-string">&quot;&#125; &#125;</span><br><span class="hljs-string">&#123; &quot;</span>ip_addr<span class="hljs-string">&quot;: &quot;</span><span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.100</span><span class="hljs-string">&quot; &#125;</span><br><span class="hljs-string">&#123; &quot;</span><span class="hljs-keyword">create</span><span class="hljs-string">&quot;: &#123; &quot;</span>_index<span class="hljs-string">&quot;: &quot;</span>liuxx<span class="hljs-number">-2024</span>-ip<span class="hljs-string">&quot;&#125; &#125;</span><br><span class="hljs-string">&#123; &quot;</span>ip_addr<span class="hljs-string">&quot;: &quot;</span><span class="hljs-number">192.168</span><span class="hljs-number">.168</span><span class="hljs-number">.168</span><span class="hljs-string">&quot; &#125;</span><br><span class="hljs-string">&#123; &quot;</span><span class="hljs-keyword">create</span><span class="hljs-string">&quot;: &#123; &quot;</span>_index<span class="hljs-string">&quot;: &quot;</span>liuxx<span class="hljs-number">-2024</span>-ip<span class="hljs-string">&quot;&#125; &#125;</span><br><span class="hljs-string">&#123; &quot;</span>ip_addr<span class="hljs-string">&quot;: &quot;</span><span class="hljs-number">172.32</span><span class="hljs-number">.1</span><span class="hljs-number">.11</span><span class="hljs-string">&quot; &#125;</span><br><span class="hljs-string">&#123; &quot;</span><span class="hljs-keyword">create</span><span class="hljs-string">&quot;: &#123; &quot;</span>_index<span class="hljs-string">&quot;: &quot;</span>liuxx<span class="hljs-number">-2024</span>-ip<span class="hljs-string">&quot;&#125; &#125;</span><br><span class="hljs-string">&#123; &quot;</span>ip_addr<span class="hljs-string">&quot;: &quot;</span><span class="hljs-number">10.100</span><span class="hljs-number">.70</span><span class="hljs-number">.200</span><span class="hljs-string">&quot; &#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h5 id="8-2-3、ip数据检索-包含192-168开头"><a href="#8-2-3、ip数据检索-包含192-168开头" class="headerlink" title="8.2.3、ip数据检索-包含192.168开头"></a>8.2.3、ip数据检索-包含192.168开头</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">GET<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">10.101</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/liuxx-2024-ip/</span>_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;ip_addr&quot;</span>: <span class="hljs-string">&quot;192.168.0.0/16&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="8-2-4、查看索引映射关系"><a href="#8-2-4、查看索引映射关系" class="headerlink" title="8.2.4、查看索引映射关系"></a>8.2.4、查看索引映射关系</h5><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span><br><span class="hljs-attribute">http</span>://<span class="hljs-number">192.168.10.101:9200</span>/liuxx-<span class="hljs-number">2024</span>-ip<br></code></pre></td></tr></table></figure><hr><h4 id="8-3、date日期案例操作"><a href="#8-3、date日期案例操作" class="headerlink" title="8.3、date日期案例操作"></a>8.3、date日期案例操作</h4><h5 id="8-3-1、创建索引时指定映射关系"><a href="#8-3-1、创建索引时指定映射关系" class="headerlink" title="8.3.1、创建索引时指定映射关系"></a>8.3.1、创建索引时指定映射关系</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT<br>http://192.168.10.101:9200/liuxx-2024-<span class="hljs-built_in">date</span><br>&#123;<br>    <span class="hljs-string">&quot;mappings&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;properties&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;birthday&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;date&quot;</span>,<br>                <span class="hljs-string">&quot;format&quot;</span>: <span class="hljs-string">&quot;yyyy-MM-dd&quot;</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="8-3-2、批量插入数据"><a href="#8-3-2、批量插入数据" class="headerlink" title="8.3.2、批量插入数据"></a>8.3.2、批量插入数据</h5><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">PUT<br>http://192.168.10.101:9200/_bulk<br>&#123; &quot;<span class="hljs-keyword">create</span><span class="hljs-string">&quot;: &#123; &quot;</span>_index<span class="hljs-string">&quot;: &quot;</span>liuxx<span class="hljs-number">-2024</span>-date<span class="hljs-string">&quot;&#125; &#125;</span><br><span class="hljs-string">&#123; &quot;</span>name<span class="hljs-string">&quot;:&quot;</span>liubb<span class="hljs-string">&quot;,&quot;</span>birthday<span class="hljs-string">&quot;: &quot;</span><span class="hljs-number">1996</span><span class="hljs-number">-04</span><span class="hljs-number">-14</span><span class="hljs-string">&quot; &#125;</span><br><span class="hljs-string">&#123; &quot;</span><span class="hljs-keyword">create</span><span class="hljs-string">&quot;: &#123; &quot;</span>_index<span class="hljs-string">&quot;: &quot;</span>liuxx<span class="hljs-number">-2024</span>-date<span class="hljs-string">&quot;&#125; &#125;</span><br><span class="hljs-string">&#123; &quot;</span>name<span class="hljs-string">&quot;:&quot;</span>zhangsan<span class="hljs-string">&quot;,&quot;</span>birthday<span class="hljs-string">&quot;: &quot;</span><span class="hljs-number">1986</span><span class="hljs-number">-05</span><span class="hljs-number">-01</span><span class="hljs-string">&quot; &#125;</span><br><span class="hljs-string">&#123; &quot;</span><span class="hljs-keyword">create</span><span class="hljs-string">&quot;: &#123; &quot;</span>_index<span class="hljs-string">&quot;: &quot;</span>liuxx<span class="hljs-number">-2024</span>-date<span class="hljs-string">&quot;&#125; &#125;</span><br><span class="hljs-string">&#123; &quot;</span>name<span class="hljs-string">&quot;:&quot;</span>lisi<span class="hljs-string">&quot;,&quot;</span>birthday<span class="hljs-string">&quot;: &quot;</span><span class="hljs-number">2002</span><span class="hljs-number">-12</span><span class="hljs-number">-11</span><span class="hljs-string">&quot; &#125;</span><br><span class="hljs-string">&#123; &quot;</span><span class="hljs-keyword">create</span><span class="hljs-string">&quot;: &#123; &quot;</span>_index<span class="hljs-string">&quot;: &quot;</span>liuxx<span class="hljs-number">-2024</span>-date<span class="hljs-string">&quot;&#125; &#125;</span><br><span class="hljs-string">&#123; &quot;</span>name<span class="hljs-string">&quot;:&quot;</span>wangwu<span class="hljs-string">&quot;,&quot;</span>birthday<span class="hljs-string">&quot;: &quot;</span><span class="hljs-number">1995</span><span class="hljs-number">-12</span><span class="hljs-number">-05</span><span class="hljs-string">&quot; &#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h5 id="8-3-3、日期排序查询"><a href="#8-3-3、日期排序查询" class="headerlink" title="8.3.3、日期排序查询"></a>8.3.3、日期排序查询</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET<br>http://192.168.10.101:9200/liuxx-2024-<span class="hljs-built_in">date</span>/_search<br>&#123;<br>    <span class="hljs-string">&quot;sort&quot;</span>: &#123;<span class="hljs-string">&quot;birthday&quot;</span>:<span class="hljs-string">&quot;asc&quot;</span>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h4 id="8-4、综合案列"><a href="#8-4、综合案列" class="headerlink" title="8.4、综合案列"></a>8.4、综合案列</h4><h5 id="8-4-1、创建索引并指定映射关系（字段属性）"><a href="#8-4-1、创建索引并指定映射关系（字段属性）" class="headerlink" title="8.4.1、创建索引并指定映射关系（字段属性）"></a>8.4.1、创建索引并指定映射关系（字段属性）</h5><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">PUT<br>http:<span class="hljs-comment">//192.168.10.101:9200/liuxx-2024-total</span><br>&#123;<br>    <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;name&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;gender&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;province&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;city&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span>,<br>                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-literal">false</span><br>            &#125;,<br>            <span class="hljs-string">&quot;email&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span> <br>            &#125;,<br>            <span class="hljs-string">&quot;ip_addr&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ip&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;birthday&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;date&quot;</span>,<br>                <span class="hljs-string">&quot;format&quot;</span>: <span class="hljs-string">&quot;yyyy-MM-dd&quot;</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="8-4-2、创建测试数据"><a href="#8-4-2、创建测试数据" class="headerlink" title="8.4.2、创建测试数据"></a>8.4.2、创建测试数据</h5><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs perl">PUT<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">10.101</span>:<span class="hljs-number">9200</span>/_bulk<br>&#123; <span class="hljs-string">&quot;create&quot;</span>: &#123; <span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;liuxx-2024-total&quot;</span>&#125;&#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;刘星星&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;男性的&quot;</span>,<span class="hljs-string">&quot;telephone&quot;</span>:<span class="hljs-string">&quot;13812345678&quot;</span>,<span class="hljs-string">&quot;province&quot;</span>:<span class="hljs-string">&quot;江苏&quot;</span>,<span class="hljs-string">&quot;city&quot;</span>:<span class="hljs-string">&quot;南京市&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;liuxx@jcjt.com&quot;</span>,<span class="hljs-string">&quot;ip_addr&quot;</span>:<span class="hljs-string">&quot;192.168.25.201&quot;</span>,<span class="hljs-string">&quot;birthday&quot;</span>:<span class="hljs-string">&quot;1999-04-05&quot;</span>&#125;<br>&#123; <span class="hljs-string">&quot;create&quot;</span>: &#123; <span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;liuxx-2024-total&quot;</span>&#125;&#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;吴亦凡&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;女性的&quot;</span>,<span class="hljs-string">&quot;telephone&quot;</span>:<span class="hljs-string">&quot;18812345678&quot;</span>,<span class="hljs-string">&quot;province&quot;</span>:<span class="hljs-string">&quot;海南&quot;</span>,<span class="hljs-string">&quot;city&quot;</span>:<span class="hljs-string">&quot;三亚&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;hendarenyixia@jcjt.com&quot;</span>,<span class="hljs-string">&quot;ip_addr&quot;</span>:<span class="hljs-string">&quot;192.168.15.31&quot;</span>,<span class="hljs-string">&quot;birthday&quot;</span>:<span class="hljs-string">&quot;2003-09-05&quot;</span>,<span class="hljs-string">&quot;hobby&quot;</span>:[<span class="hljs-string">&quot;大碗宽面&quot;</span>,<span class="hljs-string">&quot;唱&quot;</span>,<span class="hljs-string">&quot;调&quot;</span>,<span class="hljs-string">&quot;rap&quot;</span>]&#125;<br><br></code></pre></td></tr></table></figure><h5 id="8-4-3、查询数据-根据gender匹配-keyword类型不能分词"><a href="#8-4-3、查询数据-根据gender匹配-keyword类型不能分词" class="headerlink" title="8.4.3、查询数据-根据gender匹配-keyword类型不能分词"></a>8.4.3、查询数据-根据gender匹配-keyword类型不能分词</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET<br>http://192.168.10.101:9200/liuxx-2024-<span class="hljs-built_in">date</span>/_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;match&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;gender&quot;</span>: <span class="hljs-string">&quot;女&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="8-4-4、查询数据-根据name匹配-text可以分词"><a href="#8-4-4、查询数据-根据name匹配-text可以分词" class="headerlink" title="8.4.4、查询数据-根据name匹配-text可以分词"></a>8.4.4、查询数据-根据name匹配-text可以分词</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">GET<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">10.101</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/liuxx-2024-total/</span>_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;match&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;刘&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="8-4-5、查询数据-根据city匹配-设置index-false，不能被检索"><a href="#8-4-5、查询数据-根据city匹配-设置index-false，不能被检索" class="headerlink" title="8.4.5、查询数据-根据city匹配-设置index:false，不能被检索"></a>8.4.5、查询数据-根据city匹配-设置index:false，不能被检索</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">GET<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">10.101</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/liuxx-2024-total/</span>_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;match&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;city&quot;</span>: <span class="hljs-string">&quot;南京市&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="8-4-6、查询数据-根据ip-addr匹配-ip"><a href="#8-4-6、查询数据-根据ip-addr匹配-ip" class="headerlink" title="8.4.6、查询数据-根据ip_addr匹配-ip"></a>8.4.6、查询数据-根据ip_addr匹配-ip</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">GET<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">10.101</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/liuxx-2024-total/</span>_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;match&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;ip_addr&quot;</span>: <span class="hljs-string">&quot;192.168.15.0/24&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="9、分词器"><a href="#9、分词器" class="headerlink" title="9、分词器"></a>9、分词器</h3><h4 id="9-1、标准分词器"><a href="#9-1、标准分词器" class="headerlink" title="9.1、标准分词器"></a>9.1、标准分词器</h4><ul><li>英文</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts">GET<br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/_analyze</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;standard&quot;</span>,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;My name is Small Duck Liu,  and I&#x27;m 18 years old !&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>中文：并不友好</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts">GET<br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/_analyze</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;standard&quot;</span>,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;扶摇直上三千尺，疑是银河落九天!&quot;</span><br><span class="hljs-punctuation">&#125;</span>    <br></code></pre></td></tr></table></figure><h4 id="9-2、IK分词器"><a href="#9-2、IK分词器" class="headerlink" title="9.2、IK分词器"></a>9.2、IK分词器</h4><h5 id="9-2-1、官方案例（curl-JSON使用）"><a href="#9-2-1、官方案例（curl-JSON使用）" class="headerlink" title="9.2.1、官方案例（curl JSON使用）"></a>9.2.1、官方案例（curl JSON使用）</h5><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-number">1</span>)create a index<br>curl -XPUT http://localhost:<span class="hljs-number">9200</span>/index<br><br><span class="hljs-number">2</span>)create a mapping<br>curl -XPOST http://localhost:<span class="hljs-number">9200</span>/index/_mapping -H <span class="hljs-symbol">&#x27;Content</span>-<span class="hljs-keyword">Type</span>:application/json&#x27; -d&#x27;<br>&#123;<br>        <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;content&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>                <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span>,<br>                <span class="hljs-string">&quot;search_analyzer&quot;</span>: <span class="hljs-string">&quot;ik_smart&quot;</span><br>            &#125;<br>        &#125;<br><br>&#125;&#x27;<br><br><span class="hljs-number">3</span>)index <span class="hljs-keyword">some</span> docs<br>curl -XPOST http://localhost:<span class="hljs-number">9200</span>/index/_create/<span class="hljs-number">1</span> -H <span class="hljs-symbol">&#x27;Content</span>-<span class="hljs-keyword">Type</span>:application/json&#x27; -d&#x27;<br>&#123;<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;美国留给伊拉克的是个烂摊子吗&quot;</span>&#125;<br>&#x27;<br>curl -XPOST http://localhost:<span class="hljs-number">9200</span>/index/_create/<span class="hljs-number">2</span> -H <span class="hljs-symbol">&#x27;Content</span>-<span class="hljs-keyword">Type</span>:application/json&#x27; -d&#x27;<br>&#123;<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;公安部：各地校车将享最高路权&quot;</span>&#125;<br>&#x27;<br>curl -XPOST http://localhost:<span class="hljs-number">9200</span>/index/_create/<span class="hljs-number">3</span> -H <span class="hljs-symbol">&#x27;Content</span>-<span class="hljs-keyword">Type</span>:application/json&#x27; -d&#x27;<br>&#123;<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;中韩渔警冲突调查：韩警平均每天扣1艘中国渔船&quot;</span>&#125;<br>&#x27;<br>curl -XPOST http://localhost:<span class="hljs-number">9200</span>/index/_create/<span class="hljs-number">4</span> -H <span class="hljs-symbol">&#x27;Content</span>-<span class="hljs-keyword">Type</span>:application/json&#x27; -d&#x27;<br>&#123;<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首&quot;</span>&#125;<br>&#x27;<br><span class="hljs-number">4</span>.query <span class="hljs-keyword">with</span> highlighting<br><br>curl -XPOST http://localhost:<span class="hljs-number">9200</span>/index/_search  -H <span class="hljs-symbol">&#x27;Content</span>-<span class="hljs-keyword">Type</span>:application/json&#x27; -d&#x27;<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123; &quot;<span class="hljs-type">match</span><span class="hljs-string">&quot; : &#123; &quot;</span>content<span class="hljs-string">&quot; : &quot;</span>中国<span class="hljs-string">&quot; &#125;&#125;,</span><br><span class="hljs-string">    &quot;</span>highlight<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">        &quot;</span>pre_tags<span class="hljs-string">&quot; : [&quot;</span>&lt;tag1&gt;<span class="hljs-string">&quot;, &quot;</span>&lt;tag2&gt;<span class="hljs-string">&quot;],</span><br><span class="hljs-string">        &quot;</span>post_tags<span class="hljs-string">&quot; : [&quot;</span>&lt;/tag1&gt;<span class="hljs-string">&quot;, &quot;</span>&lt;/tag2&gt;<span class="hljs-string">&quot;],</span><br><span class="hljs-string">        &quot;</span>fields<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">            &quot;</span>content<span class="hljs-string">&quot; : &#123;&#125;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#x27;</span><br><span class="hljs-string">Result</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">    &quot;</span>took<span class="hljs-string">&quot;: 14,</span><br><span class="hljs-string">    &quot;</span>timed_out<span class="hljs-string">&quot;: false,</span><br><span class="hljs-string">    &quot;</span>_shards<span class="hljs-string">&quot;: &#123;</span><br><span class="hljs-string">        &quot;</span>total<span class="hljs-string">&quot;: 5,</span><br><span class="hljs-string">        &quot;</span>successful<span class="hljs-string">&quot;: 5,</span><br><span class="hljs-string">        &quot;</span>failed<span class="hljs-string">&quot;: 0</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &quot;</span>hits<span class="hljs-string">&quot;: &#123;</span><br><span class="hljs-string">        &quot;</span>total<span class="hljs-string">&quot;: 2,</span><br><span class="hljs-string">        &quot;</span>max_score<span class="hljs-string">&quot;: 2,</span><br><span class="hljs-string">        &quot;</span>hits<span class="hljs-string">&quot;: [</span><br><span class="hljs-string">            &#123;</span><br><span class="hljs-string">                &quot;</span>_index<span class="hljs-string">&quot;: &quot;</span>index<span class="hljs-string">&quot;,</span><br><span class="hljs-string">                &quot;</span>_type<span class="hljs-string">&quot;: &quot;</span>fulltext<span class="hljs-string">&quot;,</span><br><span class="hljs-string">                &quot;</span>_id<span class="hljs-string">&quot;: &quot;</span><span class="hljs-number">4</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">                &quot;</span>_score<span class="hljs-string">&quot;: 2,</span><br><span class="hljs-string">                &quot;</span>_source<span class="hljs-string">&quot;: &#123;</span><br><span class="hljs-string">                    &quot;</span>content<span class="hljs-string">&quot;: &quot;</span>中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首<span class="hljs-string">&quot;</span><br><span class="hljs-string">                &#125;,</span><br><span class="hljs-string">                &quot;</span>highlight<span class="hljs-string">&quot;: &#123;</span><br><span class="hljs-string">                    &quot;</span>content<span class="hljs-string">&quot;: [</span><br><span class="hljs-string">                        &quot;</span>&lt;tag1&gt;中国&lt;/tag1&gt;驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首 <span class="hljs-string">&quot;</span><br><span class="hljs-string">                    ]</span><br><span class="hljs-string">                &#125;</span><br><span class="hljs-string">            &#125;,</span><br><span class="hljs-string">            &#123;</span><br><span class="hljs-string">                &quot;</span>_index<span class="hljs-string">&quot;: &quot;</span>index<span class="hljs-string">&quot;,</span><br><span class="hljs-string">                &quot;</span>_type<span class="hljs-string">&quot;: &quot;</span>fulltext<span class="hljs-string">&quot;,</span><br><span class="hljs-string">                &quot;</span>_id<span class="hljs-string">&quot;: &quot;</span><span class="hljs-number">3</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">                &quot;</span>_score<span class="hljs-string">&quot;: 2,</span><br><span class="hljs-string">                &quot;</span>_source<span class="hljs-string">&quot;: &#123;</span><br><span class="hljs-string">                    &quot;</span>content<span class="hljs-string">&quot;: &quot;</span>中韩渔警冲突调查：韩警平均每天扣<span class="hljs-number">1</span>艘中国渔船<span class="hljs-string">&quot;</span><br><span class="hljs-string">                &#125;,</span><br><span class="hljs-string">                &quot;</span>highlight<span class="hljs-string">&quot;: &#123;</span><br><span class="hljs-string">                    &quot;</span>content<span class="hljs-string">&quot;: [</span><br><span class="hljs-string">                        &quot;</span>均每天扣<span class="hljs-number">1</span>艘&lt;tag1&gt;中国&lt;/tag1&gt;渔船 <span class="hljs-string">&quot;</span><br><span class="hljs-string">                    ]</span><br><span class="hljs-string">                &#125;</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string">        ]</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure><h5 id="9-2-2、安装IK分词器"><a href="#9-2-2、安装IK分词器" class="headerlink" title="9.2.2、安装IK分词器"></a>9.2.2、安装IK分词器</h5><ul><li>官网文档</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/infinilabs/</span>analysis-ik<br><br>下载地址 <br>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/infinilabs/</span>analysis-ik<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/v7.17.16/</span>elasticsearch-analysis-ik-<span class="hljs-number">7.17</span>.<span class="hljs-number">16</span>.zip<br></code></pre></td></tr></table></figure><ul><li>安装步骤</li></ul><blockquote><p>这里有个坑 7.17.15版本。没有elasticsearch-ik分词器</p><img src="ElasticSearch.assets/image-20240409150340946.png" alt="image-20240409150340946" style="zoom:67%;" /></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir /elasticsearch/softwares/es7/elasticsearch-7.17.15/plugins/ik<br>cd /elasticsearch/softwares/es7/elasticsearch-7.17.15/plugins/ik<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">上传</span><br>[root@node10-101 ik]# ls<br>elasticsearch-analysis-ik-7.17.16.zip<br><span class="hljs-meta prompt_"># </span><span class="language-bash">解压</span><br>unzip ./elasticsearch-analysis-ik-7.17.16.zip<br><br>[root@node10-101 ik]# ls<br>commons-codec-1.9.jar    elasticsearch-analysis-ik-7.17.16.jar  httpcore-4.4.4.jar<br>commons-logging-1.2.jar  elasticsearch-analysis-ik-7.17.16.zip  plugin-descriptor.properties<br>config                   httpclient-4.5.2.jar                   plugin-security.policy<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改配置</span><br>[root@node10-101 ik]# pwd<br>/elasticsearch/softwares/es7/elasticsearch-7.17.15/plugins/ik<br>[root@node10-101 ik]# mv elasticsearch-analysis-ik-7.17.16.jar elasticsearch-analysis-ik-7.17.15.jar<br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改配置文件</span><br>[root@node10-101 ik]# yy plugin-descriptor.properties<br>description=IK Analyzer for Elasticsearch<br>version=7.17.15<br>name=analysis-ik<br>classname=org.elasticsearch.plugin.analysis.ik.AnalysisIkPlugin<br>java.version=1.8<br>elasticsearch.version=7.17.15<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">重启服务</span><br>systemctl restart es7<br></code></pre></td></tr></table></figure><h5 id="9-2-3、中文测试"><a href="#9-2-3、中文测试" class="headerlink" title="9.2.3、中文测试"></a>9.2.3、中文测试</h5><ul><li>ik分词器-中文-细粒度</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts">GET<br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/_analyze</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span>,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;扶摇直上三千尺，疑是银河落九天!&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>ik分词器-中文-粗粒度</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts">GET<br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/_analyze</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_smart&quot;</span>,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;扶摇直上三千尺，疑是银河落九天!&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h5 id="9-2-4、创建自定义中文词典"><a href="#9-2-4、创建自定义中文词典" class="headerlink" title="9.2.4、创建自定义中文词典"></a>9.2.4、创建自定义中文词典</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /elasticsearch/softwares/es7/elasticsearch-7.17.15/plugins/ik/config/<br><br>cat &gt; liuxx-20240409.dic &lt;&lt;&#x27;EOF&#x27;<br>德玛西亚<br>艾欧尼亚<br>亚索<br>上号<br>带你飞<br>贼6<br>EOF<br><br>vim IKAnalyzer.cfg.xml<br>...<br>&lt;entry key=&quot;ext_dict&quot;&gt;liuxx-20240409.dic&lt;/entry&gt;<br>...<br><br>systemctl restart es7<br></code></pre></td></tr></table></figure><ul><li>测试</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts">GET<br><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.10.101:9200/_analyze</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_smart&quot;</span>,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;嗨，哥们! 上号，我德玛西亚和艾欧尼亚都有号! 我亚索贼6，肯定能带你飞!!!&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><hr><h3 id="10、Kibana可视化界面"><a href="#10、Kibana可视化界面" class="headerlink" title="10、Kibana可视化界面"></a>10、Kibana可视化界面</h3><h4 id="10-1、下载安装"><a href="#10-1、下载安装" class="headerlink" title="10.1、下载安装"></a>10.1、下载安装</h4><ul><li>官网下载地址</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://www.elastic.co/downloads/past-releases/kibana-<span class="hljs-number">7</span>-<span class="hljs-number">17</span>-<span class="hljs-number">15</span><br></code></pre></td></tr></table></figure><ul><li><p>安装</p><p>node10-101机器上</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@node10-101 ~]# ls | grep kiba<br>kibana-7.17.15-x86_64.rpm<br><br>rpm -ivh kibana-7.17.15-x86_64.rpm<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改配置</span><br>vim /etc/kibana/kibana.yml<br>[root@node10-101 ~]# yy /etc/kibana/kibana.yml<br>server.host: &quot;0.0.0.0&quot;<br>elasticsearch.hosts: [&quot;http://192.168.10.101:9200&quot;,&quot;http://192.168.10.102:9200&quot;,&quot;http://192.168.10.103:9200&quot;]<br>i18n.locale: &quot;zh-CN&quot;<br><br>systemctl enable --now kibana<br></code></pre></td></tr></table></figure><ul><li>访问地址</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs s">http://192.168.10.101:5601/<br></code></pre></td></tr></table></figure><h4 id="10-2、使用"><a href="#10-2、使用" class="headerlink" title="10.2、使用"></a>10.2、使用</h4><img src="ElasticSearch.assets/image-20240409154424169.png" alt="image-20240409154424169" style="zoom:67%;" /><img src="ElasticSearch.assets/image-20240409154506837.png" alt="image-20240409154506837" style="zoom:67%;" /><h5 id="10-2-1、开发工具控制台"><a href="#10-2-1、开发工具控制台" class="headerlink" title="10.2.1、开发工具控制台"></a>10.2.1、开发工具控制台</h5><img src="ElasticSearch.assets/image-20240409154931462.png" alt="image-20240409154931462" style="zoom:67%;" /><p><img src="/ElasticSearch.assets/image-20240409154839568.png" alt="image-20240409154839568"></p><hr><h3 id="11、master节点和data节点分离"><a href="#11、master节点和data节点分离" class="headerlink" title="11、master节点和data节点分离"></a>11、master节点和data节点分离</h3><h4 id="11-1、常用角色"><a href="#11-1、常用角色" class="headerlink" title="11.1、常用角色"></a>11.1、常用角色</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">c: Cold data <br><br>d: data <span class="hljs-keyword">node</span><br><br>f:<span class="hljs-title"> frozen</span> <span class="hljs-keyword">node</span><br><br>h:<span class="hljs-title"> hot</span> <span class="hljs-keyword">node</span><br><br>i:<span class="hljs-title"> ingest</span> <span class="hljs-keyword">node</span><br><br>l:<span class="hljs-title"> machine</span> learning <span class="hljs-keyword">node</span><br><br>m:<span class="hljs-title"> master</span> eligible <span class="hljs-keyword">node</span><br><br>r:<span class="hljs-title"> remote</span> cluster client <span class="hljs-keyword">node</span><br><br>s:<span class="hljs-title"> content</span> <span class="hljs-keyword">node</span><br><br>t:<span class="hljs-title"> transform</span> <span class="hljs-keyword">node</span><br><br>v:<span class="hljs-title"> voting-only</span> <span class="hljs-keyword">node</span><br><br>w:<span class="hljs-title"> warm</span> <span class="hljs-keyword">node</span><br><br>-:<span class="hljs-title"> coordinating</span> <span class="hljs-keyword">node</span> <span class="hljs-title">only</span><br></code></pre></td></tr></table></figure><ul><li><p>data node：指的是存储数据节点。</p><p>node.data: true</p></li><li><p>master node：控制ES集群，并维护集群的状态（cluster state，包括节点信息，索引信息等，ES集群每个节点都有一份）</p><p>node.master: true</p></li><li><p>coordinating：协调节点可以处理请求的节点，ES集群所有的节点均为协调节点，该角色无法取消。</p></li></ul><hr><h4 id="11-2、配置步骤"><a href="#11-2、配置步骤" class="headerlink" title="11.2、配置步骤"></a>11.2、配置步骤</h4><ul><li>集群节点状态</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@node10-101 ~]# curl http://192.168.10.101:9200/_cat/nodes<br>192.168.10.102 37 57 0 0.00 0.01 0.05 cdfhilmrstw - node10-102<br>192.168.10.101 71 91 0 0.01 0.06 0.06 cdfhilmrstw * node10-101<br>192.168.10.103 49 47 0 0.00 0.01 0.05 cdfhilmrstw - node10-103<br><br></code></pre></td></tr></table></figure><p>1、停止所有节点ES服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl stop es7<br></code></pre></td></tr></table></figure><p>2、清空所有节点数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rm -rf  /elasticsearch/&#123;data,logs&#125;/es7/* /tmp/*<br></code></pre></td></tr></table></figure><p>3、修改配置文件（我们希望node10-103是master节点，node10-101和node10-102为数据节点不参与master选举）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">node10-101</span><br>vim /elasticsearch/softwares/es7/elasticsearch-7.17.15/config/elasticsearch.yml<br>cluster.name: liuxx-es-2024<br>path.data: /elasticsearch/data/es7<br>path.logs: /elasticsearch/logs/es7<br>network.host: 0.0.0.0<br>discovery.seed_hosts: [&quot;node10-101&quot;,&quot;node10-102&quot;,&quot;node10-103&quot;]<br>cluster.initial_master_nodes: [&quot;node10-103&quot;]<br>node.data: true<br>node.master: false<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">node10-102</span><br>vim /elasticsearch/softwares/es7/elasticsearch-7.17.15/config/elasticsearch.yml<br>cluster.name: liuxx-es-2024<br>path.data: /elasticsearch/data/es7<br>path.logs: /elasticsearch/logs/es7<br>network.host: 0.0.0.0<br>discovery.seed_hosts: [&quot;node10-101&quot;,&quot;node10-102&quot;,&quot;node10-103&quot;]<br>cluster.initial_master_nodes: [&quot;node10-103&quot;]<br>node.data: true<br>node.master: false<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">node10-103</span><br>vim /elasticsearch/softwares/es7/elasticsearch-7.17.15/config/elasticsearch.yml<br>cluster.name: liuxx-es-2024<br>path.data: /elasticsearch/data/es7<br>path.logs: /elasticsearch/logs/es7<br>network.host: 0.0.0.0<br>discovery.seed_hosts: [&quot;node10-101&quot;,&quot;node10-102&quot;,&quot;node10-103&quot;]<br>cluster.initial_master_nodes: [&quot;node10-103&quot;]<br>node.data: false<br>node.master: master<br></code></pre></td></tr></table></figure><p>4、启动服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl start es7<br></code></pre></td></tr></table></figure><ul><li>集群节点状态</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@node10-101 config]# curl http://192.168.10.101:9200/_cat/nodes<br>192.168.10.102 53 47 21 0.47 0.16 0.10 cdfhilrstw - node10-102<br>192.168.10.101 54 88 22 0.42 0.16 0.09 cdfhilrstw - node10-101<br>192.168.10.103 52 37 20 0.28 0.13 0.08 ilmr       * node10-103<br><br></code></pre></td></tr></table></figure><hr>]]></content>
    
    
    <categories>
      
      <category>ES</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ElasticSearch_v7.17.15</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows系统配置nvm_npm版本管理工具</title>
    <link href="/2024/04/30/Windows%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%85%8D%E7%BD%AEnvm_npm%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/"/>
    <url>/2024/04/30/Windows%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%85%8D%E7%BD%AEnvm_npm%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/</url>
    
    <content type="html"><![CDATA[<h2 id="Windows系统配置nvm-npm版本管理工具"><a href="#Windows系统配置nvm-npm版本管理工具" class="headerlink" title="Windows系统配置nvm_npm版本管理工具"></a>Windows系统配置nvm_npm版本管理工具</h2><ul><li><p>官网下载地址</p><p><a href="https://github.com/coreybutler/nvm-windows/releases">https://github.com/coreybutler/nvm-windows/releases</a></p></li><li><p>安装时，不要有中文或空格，并且卸载掉原有的node.js，下一步下一步安装。</p></li></ul><h3 id="1、使用"><a href="#1、使用" class="headerlink" title="1、使用"></a>1、使用</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">指定taobao镜像</span><br>nvm node_mirror http://npm.taobao.org/mirrors/node/<br>nvm npm_mirror https://npm.taobao.org/mirrors/npm/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看node可用版本</span><br>nvm list available<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">安装版本npm</span><br>nvm install 16.16.0<br>nvm install 14.20.0<br>nvm install 12.22.12<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">切换</span><br>nvm use 16.16.0<br><br></code></pre></td></tr></table></figure><h3 id="2、还原镜像"><a href="#2、还原镜像" class="headerlink" title="2、还原镜像"></a>2、还原镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">taobao镜像</span><br>npm config set registry https://registry.npm.taobao.org/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">还原</span><br>npm config set registry https://registry.npmmirror.com/<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>npm</category>
      
    </categories>
    
    
    <tags>
      
      <tag>npm</tag>
      
      <tag>nvm</tag>
      
      <tag>node.js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oracle11g数据库常用命令操作</title>
    <link href="/2021/06/10/Oracle11g%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/"/>
    <url>/2021/06/10/Oracle11g%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h2 id="Oracle11g日常操作命令"><a href="#Oracle11g日常操作命令" class="headerlink" title="Oracle11g日常操作命令"></a>Oracle11g日常操作命令</h2><h3 id="1、建表语句"><a href="#1、建表语句" class="headerlink" title="1、建表语句"></a>1、建表语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> sys_user (<br>  user_id           number(<span class="hljs-number">20</span>) <span class="hljs-keyword">CONSTRAINT</span> pk_employee <span class="hljs-keyword">PRIMARY</span> KEY <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>  dept_id           number(<span class="hljs-number">20</span>)      <span class="hljs-keyword">default</span> <span class="hljs-keyword">null</span>,<br>  user_name         varchar2(<span class="hljs-number">30</span>)    <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>  nick_name         varchar2(<span class="hljs-number">30</span>)    <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>,<br>  user_type         varchar2(<span class="hljs-number">2</span>)     <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;00&#x27;</span>,<br>  email             varchar2(<span class="hljs-number">50</span>)    <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>,<br>  phonenumber       varchar2(<span class="hljs-number">11</span>)    <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>,<br>  sex               <span class="hljs-type">char</span>(<span class="hljs-number">1</span>)         <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>  avatar            varchar2(<span class="hljs-number">100</span>)   <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>,<br>  password          varchar2(<span class="hljs-number">100</span>)   <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>,<br>  status            <span class="hljs-type">char</span>(<span class="hljs-number">1</span>)         <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>  del_flag          <span class="hljs-type">char</span>(<span class="hljs-number">1</span>)         <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>  login_ip          varchar2(<span class="hljs-number">128</span>)   <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>,<br>  login_date        <span class="hljs-type">date</span>,<br>  create_by         varchar2(<span class="hljs-number">64</span>),<br>  create_time     <span class="hljs-type">date</span>,<br>  update_by         varchar2(<span class="hljs-number">64</span>)    <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>,<br>  update_time       <span class="hljs-type">date</span>,<br>  remark            varchar2(<span class="hljs-number">500</span>)   <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span><br>);<br><br><span class="hljs-comment">-- 主键自增序列</span><br><span class="hljs-keyword">create</span> sequence seq_sys_user<br> increment <span class="hljs-keyword">by</span> <span class="hljs-number">1</span><br> <span class="hljs-keyword">start</span> <span class="hljs-keyword">with</span> <span class="hljs-number">100</span><br> nomaxvalue<br> nominvalue<br> cache <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure><h4 id="1-1、主键自增-序列"><a href="#1-1、主键自增-序列" class="headerlink" title="1.1、主键自增(序列)"></a>1.1、主键自增(序列)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- emp表， empno的自增序列：</span><br><span class="hljs-keyword">create</span> sequence seq_on_scott_emp_empno<br>increment <span class="hljs-keyword">by</span> <span class="hljs-number">1</span> <span class="hljs-comment">-- 每次加几个</span><br><span class="hljs-keyword">start</span> <span class="hljs-keyword">with</span> <span class="hljs-number">8000</span> <span class="hljs-comment">-- 从几开始</span><br>nomaxvalue <span class="hljs-comment">-- 不设置最大值</span><br>nocycle <span class="hljs-comment">-- 一直累加，不循环</span><br>nocache;<br><br><span class="hljs-comment">-- 记得提交：</span><br><span class="hljs-keyword">commit</span>;<br><br><span class="hljs-comment">-- currval 当前序列；nextval 下一个序列</span><br><span class="hljs-keyword">select</span> seq_on_scott_emp_empno.currval <span class="hljs-keyword">from</span> dual;<br><br><span class="hljs-comment">-- dept表， deptno的自增序列：</span><br><span class="hljs-keyword">create</span> sequence seq_on_scott_dept_deptno<br><span class="hljs-comment">-- 每次加几个</span><br>increment <span class="hljs-keyword">by</span> <span class="hljs-number">10</span><br><span class="hljs-comment">-- 从几开始</span><br><span class="hljs-keyword">start</span> <span class="hljs-keyword">with</span> <span class="hljs-number">50</span><br><span class="hljs-comment">-- [&#123;MAXVALUE/ MINVALUE n| NOMAXVALUE 不设置最大值&#125;]</span><br>maxvalue <span class="hljs-number">100</span><br><span class="hljs-comment">-- [&#123;CYCLE | NOCYCLE 一直累加，不循环&#125;]</span><br>NOCYCLE<br><span class="hljs-comment">-- [&#123;CACHE n| NOCACHE&#125;]</span><br>nocache;<br><br><span class="hljs-comment">-----</span><br><span class="hljs-keyword">create</span> sequence seq_on_scott_dept_deptno<br>increment <span class="hljs-keyword">by</span> <span class="hljs-number">10</span><br><span class="hljs-keyword">start</span> <span class="hljs-keyword">with</span> <span class="hljs-number">50</span><br>maxvalue <span class="hljs-number">9999</span><br>NOCYCLE<br>nocache;<br></code></pre></td></tr></table></figure><h4 id="1-2、约束"><a href="#1-2、约束" class="headerlink" title="1.2、约束"></a>1.2、约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 外键：</span><br><span class="hljs-keyword">constraint</span> fk_user_txt_user_id <span class="hljs-keyword">foreign</span> key (txt_userid) <span class="hljs-keyword">references</span> tb_user111(userid);<br><br><span class="hljs-comment">-- 主键</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> tb_user <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> pk_user_userid <span class="hljs-keyword">PRIMARY</span> KEY (userid);<br><br><span class="hljs-comment">-- check</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> tb_user ck_user_username <span class="hljs-keyword">CHECK</span> ( length( username ) <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">4</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">20</span> ); <br><br><span class="hljs-comment">-- 唯一</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> tb_user  <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> uq_user_email <span class="hljs-keyword">UNIQUE</span> ( email ) <br><br><span class="hljs-comment">-- 非空</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> tb_user modify ( username <span class="hljs-keyword">CONSTRAINT</span> nn_user_username <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> ); <br><br><span class="hljs-comment">-- 默认值</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> tb_user modify ( age <span class="hljs-keyword">DEFAULT</span> ( <span class="hljs-number">18</span> ) ); <br><br><span class="hljs-comment">-- 外键</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> &quot;SCOTT&quot;.&quot;TB_TXT&quot; <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> &quot;SYS_C0011117&quot; <span class="hljs-keyword">FOREIGN</span> KEY (&quot;TXT_USERID&quot;) <br><span class="hljs-keyword">REFERENCES</span> &quot;SCOTT&quot;.&quot;TB_USER&quot; (&quot;USERID&quot;) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span>;<br><br><span class="hljs-comment">-- 删除约束</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> tb_user <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">constraint</span> uq_user_email cascade;<br></code></pre></td></tr></table></figure><hr><h4 id="1-3、字段"><a href="#1-3、字段" class="headerlink" title="1.3、字段"></a>1.3、字段</h4><h5 id="1-3-1、字符串"><a href="#1-3-1、字符串" class="headerlink" title="1.3.1、字符串"></a>1.3.1、字符串</h5><ul><li><p>varchar2(size)</p><p>可变长度字符串，size&#x3D;1~4000，必须指定size值。</p></li><li><p>char(size)</p><p>固定长度字符串，size&#x3D;1~2000。</p></li><li><p>long</p><p>可变长字符，长度2G个字节。</p></li></ul><h5 id="1-3-2、数字"><a href="#1-3-2、数字" class="headerlink" title="1.3.2、数字"></a>1.3.2、数字</h5><ul><li><p>number(p,s)</p><p>整数：number(5)</p><p>小数：number(7,2)，有效位数7位，整数5位，小数2位<code>（p=1~38，s=-84~127）</code>。</p></li></ul><h5 id="1-3-3、日期"><a href="#1-3-3、日期" class="headerlink" title="1.3.3、日期"></a>1.3.3、日期</h5><ul><li><p>date</p><p>有效日期：公元前4712年1月1日，到公元后4712年1月1日。</p></li></ul><h5 id="1-3-4、字符大型对象"><a href="#1-3-4、字符大型对象" class="headerlink" title="1.3.4、字符大型对象"></a>1.3.4、字符大型对象</h5><ul><li><p>clob</p><p>一个字符大型对象，可容纳单个字节的字符，不支持宽度不等的字符集，最大4G字节。</p></li><li><p>nclob</p><p>一个字符大型对象，可容纳单个字节的字符，不支持宽度不等的字符集，最大4G字节（存储国家字符集）。</p></li><li><p>blob</p><p>一个二进制大型对象，最大4G字节。</p></li></ul><hr><h3 id="2、函数"><a href="#2、函数" class="headerlink" title="2、函数"></a>2、函数</h3><h4 id="2-1、字符串函数"><a href="#2-1、字符串函数" class="headerlink" title="2.1、字符串函数"></a>2.1、字符串函数</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 有空值</span><br>nvl(ename,<span class="hljs-string">&#x27;&#x27;</span>)<br><br><span class="hljs-comment">-- 字符串拼接</span><br><span class="hljs-keyword">select</span> ename, ename<span class="hljs-operator">||</span><span class="hljs-string">&#x27;职位是&#x27;</span><span class="hljs-operator">||</span>job <span class="hljs-keyword">from</span> emp;<br><span class="hljs-keyword">SELECT</span> ename,concat( concat( ename, <span class="hljs-string">&#x27;职位是&#x27;</span> ), job ) 描述 <span class="hljs-keyword">FROM</span> emp;<br><br><span class="hljs-comment">-- 字符串截取、替换</span><br>replace(str,<span class="hljs-keyword">old</span>,<span class="hljs-keyword">new</span>)<br>substr(str,<span class="hljs-keyword">start</span>,length)<br><br><span class="hljs-comment">-- 查询</span><br>instr( <span class="hljs-string">&#x27;helloworld&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span> )<br><span class="hljs-comment">-- 这4表示起始位置; 这2表示字符若重复，查找第2个字符</span><br>instr( <span class="hljs-string">&#x27;helloworld&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span> )<br><br><span class="hljs-comment">-- 字符串转数字</span><br>to_number(<span class="hljs-string">&#x27;11&#x27;</span><span class="hljs-operator">+</span><span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><h4 id="2-2、日期函数"><a href="#2-2、日期函数" class="headerlink" title="2.2、日期函数"></a>2.2、日期函数</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 系统当前时间：</span><br>sysdate<br><span class="hljs-built_in">current_date</span><br><br><span class="hljs-comment">-- 系统最后一天：</span><br>sysdate<span class="hljs-operator">+</span><span class="hljs-number">1</span><br><br><span class="hljs-comment">-- 3个月后转正时间：</span><br>add_months(hiredate,<span class="hljs-number">3</span>)<br><br><span class="hljs-comment">-- 当前时间最后一天：</span><br>last_day(sysdate)<br><br><span class="hljs-comment">-- 当前时间最后一天：</span><br>last_day(sysdate)<span class="hljs-comment">-- 查询入职时间到现在共几个月：</span><br><span class="hljs-keyword">SELECT</span> sysdate,hiredate,months_between ( sysdate, hiredate ) <span class="hljs-keyword">FROM</span> emp;<br><br><span class="hljs-comment">-- 查询当前时间，到下周周一的时间：</span><br><span class="hljs-keyword">select</span> sysdate,next_day(sysdate,<span class="hljs-string">&#x27;Monday&#x27;</span>) <span class="hljs-keyword">from</span> dual;<br><br><span class="hljs-comment">-- 查询入职时间大于1985年的</span><br><span class="hljs-keyword">SELECT</span> empno <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> HIREDATE <span class="hljs-operator">&gt;</span> TO_DATE( <span class="hljs-string">&#x27;1985&#x27;</span>, <span class="hljs-string">&#x27;yyyy&#x27;</span> ) <br></code></pre></td></tr></table></figure><h5 id="2-2-1、-日期转字符串"><a href="#2-2-1、-日期转字符串" class="headerlink" title="2.2.1、*日期转字符串"></a>2.2.1、*日期转字符串</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- publish_time使用NUMBER(15)  1577145600</span><br><span class="hljs-keyword">select</span> to_char(unix_to_date(publish_time), <span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>) <span class="hljs-keyword">from</span> assi_sys_notice;<br><br><span class="hljs-comment">-- 日期转字符：</span><br><span class="hljs-keyword">select</span> hiredate,to_char(hiredate, <span class="hljs-string">&#x27;yyyy/mm/dd&#x27;</span>) <span class="hljs-keyword">from</span> emp;<br><span class="hljs-comment">-- 中文需要加上 &quot;&quot; 双引号</span><br><span class="hljs-keyword">SELECT</span> hiredate,to_char ( hiredate, <span class="hljs-string">&#x27;yyyy&quot;年&quot;mm&quot;月&quot;dd&quot;日&quot;&#x27;</span> ) <span class="hljs-keyword">FROM</span> emp;<br><br><span class="hljs-comment">-- 字符转日期：</span><br><span class="hljs-keyword">SELECT</span> to_date (<span class="hljs-string">&#x27;1996-04-14&#x27;</span>, <span class="hljs-string">&#x27;yyyy/mm/dd&#x27;</span>) <span class="hljs-keyword">FROM</span> DUAL;<br></code></pre></td></tr></table></figure><hr><h3 id="3、有则修改无则新增-merge-into"><a href="#3、有则修改无则新增-merge-into" class="headerlink" title="3、有则修改无则新增 merge into"></a>3、有则修改无则新增 merge into</h3><ul><li><p>查询目标表和原表中是否有相同的数据，有就修改，没有就新增。</p></li><li><p>解释：merge into 目标表 using 原表或者select查询的表 on 匹配相同字段如id，<br>when matched then 有相同，when not matched then 没有相同。</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">MERGE</span> <span class="hljs-keyword">INTO</span> target_table t<br><span class="hljs-keyword">USING</span> source_table s<br><span class="hljs-keyword">ON</span> (t.id <span class="hljs-operator">=</span> s.id)<br><span class="hljs-keyword">WHEN</span> MATCHED <span class="hljs-keyword">THEN</span><br>  <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">SET</span> t.col1 <span class="hljs-operator">=</span> s.col1, t.col2 <span class="hljs-operator">=</span> s.col2<br><span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">NOT</span> MATCHED <span class="hljs-keyword">THEN</span><br>  <span class="hljs-keyword">INSERT</span> (t.id, t.col1, t.col2) <span class="hljs-keyword">VALUES</span> (s.id, s.col1, s.col2);<br>  <br><span class="hljs-comment">-- scott数据：</span><br><span class="hljs-keyword">MERGE</span> <span class="hljs-keyword">INTO</span> emp e1<br><span class="hljs-keyword">USING</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> empno <span class="hljs-operator">=</span> <span class="hljs-number">8000</span>) e2<br><span class="hljs-keyword">ON</span> (e1.empno <span class="hljs-operator">=</span> e2.empno)<br><span class="hljs-keyword">WHEN</span> MATCHED <span class="hljs-keyword">THEN</span><br>  <span class="hljs-keyword">UPDATE</span><br>     <span class="hljs-keyword">SET</span> e1.ename <span class="hljs-operator">=</span> e2.ename<br>        ,e1.hiredate <span class="hljs-operator">=</span> to_date(to_char(SYSDATE, <span class="hljs-string">&#x27;YYYY/MM/DD&#x27;</span>), <span class="hljs-string">&#x27;YYYY/MM/DD&#x27;</span>)<br><span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">NOT</span> MATCHED <span class="hljs-keyword">THEN</span><br>  <span class="hljs-keyword">INSERT</span> (e1.empno,e1.ename,e1.job,e1.mgr,e1.sal,e1.comm)<br>  <span class="hljs-keyword">VALUES</span> (e2.empno,e2.ename,e2.job,e2.mgr,e2.sal,e2.comm)<br></code></pre></td></tr></table></figure><hr><h3 id="4、分页-rownum"><a href="#4、分页-rownum" class="headerlink" title="4、分页 rownum"></a>4、分页 rownum</h3><ul><li><p>oracle不支持limit分页</p></li><li><p>使用rownum分页，而且不支持直接使用大于号。</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- rownum: 到第6行， rw：从第1行开始</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <br><span class="hljs-keyword">FROM</span> ( <span class="hljs-keyword">SELECT</span> ROWNUM rw, a.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> ( <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> emp ) a <span class="hljs-keyword">WHERE</span> ROWNUM <span class="hljs-operator">&lt;=</span> <span class="hljs-number">6</span> ) b <br><span class="hljs-keyword">WHERE</span> b.rw <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>;<br><br><span class="hljs-comment">-- 表连接分页</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span><br>(<span class="hljs-keyword">SELECT</span> ROWNUM rw,a.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span><br> ( <span class="hljs-keyword">SELECT</span> e.<span class="hljs-operator">*</span>, d.dname <span class="hljs-keyword">FROM</span> emp e <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept d <span class="hljs-keyword">ON</span> e.DEPTNO <span class="hljs-operator">=</span> d.deptno <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> e.empno ) <br> a <span class="hljs-keyword">WHERE</span> ROWNUM <span class="hljs-operator">&lt;=</span> <span class="hljs-number">10</span>)<br> b <span class="hljs-keyword">WHERE</span> b.rw <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span>;<br></code></pre></td></tr></table></figure><hr>]]></content>
    
    
    <categories>
      
      <category>SQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle11g</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
